/*!
 * Ilmcharts v1.1.2 (http://ilm.majasa.ee)
 * Copyright 2012-2014 Aivo Pruekk
 * Licensed under MIT (https://github.com/aivoprykk/ilmcharts/blob/master/LICENSE)
 */
if("undefined"==typeof jQuery)throw new Error("Ilmcharts's JavaScript requires jQuery");var ilm=function(my){function State(opt){opt=opt||{};var defaults={id:"ilmchartsstore01",datamode:opt.datamode||"emu",timeframe:opt.timeframe||864e5,fcplace:opt.fcplace||"tabivere",curplace:opt.curplace||"emu",chartorder:["temp","wind_speed","wind_dir"],showgroup:""};return this.id=defaults.id,this.attr=defaults,this}function App(placeholder){this.state=(new State).load(),this.placeholder=placeholder||"#container",this.dataurl="/cgi-bin/cpp/ilm/image.cgi?t=json",this.digits=1,this.fcplaces={tabivere:{id:"tabivere",name:"Saadjärv",wglink:"266923",yrlink:"Jõgevamaa/Tabivere~587488",group:"jarv"},tamme:{id:"tamme",name:"Võrtsjärv",wglink:192609,yrlink:"Tartumaa/Tamme",group:"jarv"},rapina:{id:"rapina",name:"Peipsi Räpina",wglink:183648,yrlink:"Põlvamaa/Võõpsu",group:"jarv"},pirita:{id:"pirita",name:"Pirita",wglink:125320,yrlink:"Harjumaa/Pirita~798565",group:"meri"},rohuneeme:{id:"rohuneeme",name:"Püünsi",wglink:70524,yrlink:"Harjumaa/Rohuneeme",group:"meri"},topu:{id:"topu",name:"Topu",wglink:18713,yrlink:"Läänemaa/Topu",group:"meri"},parnu:{id:"parnu",name:"Pärnu",wglink:92781,yrlink:"Pärnumaa/Pärnu",group:"meri"},haademeeste:{id:"haademeeste",name:"Häädemeeste",wglink:246420,yrlink:"Pärnumaa/Häädemeeste",group:"meri"},ristna:{id:"ristna",name:"Ristna",wglink:96592,yrlink:"Hiiumaa/Ristna",group:"meri"}},this.fcplace=this.state.attr.fcplace,this.curplaces={emu:{id:"emu",name:"Tartu EMU",group:"jarv",link:"/weather"},mnt_tamme:{id:"mnt_tamme",name:"V-Rakke MNT",group:"jarv",link:""},mnt_rapina:{id:"mnt_rapina",name:"Räpina MNT",group:"jarv",link:""},mnt_uhmardu:{id:"mnt_uhmardu",name:"Uhmardu MNT",group:"jarv",link:""},mnt_jogeva:{id:"mnt_jogeva",name:"Jõgeva MNT",group:"jarv",link:""},emhi_pirita:{id:"emhi_pirita",name:"Pirita EMHI",group:"meri",link:"/meri/vaatlusandmed/"},emhi_rohuneeme:{id:"emhi_rohuneeme",name:"Püünsi EMHI",group:"meri",link:"/meri/vaatlusandmed/"},emhi_topu:{id:"emhi_topu",name:"Haapsalu EMHI",group:"meri",link:"/meri/vaatlusandmed/"},emhi_parnu:{id:"emhi_parnu",name:"Pärnu EMHI",group:"meri",link:"/meri/vaatlusandmed/"},emhi_haademeeste:{id:"emhi_haademeeste",name:"Häädemeeste EMHI",group:"meri",link:"/meri/vaatlusandmed/"},emhi_ristna:{id:"emhi_ristna",name:"Ristna EMHI",group:"meri",link:"/meri/vaatlusandmed/"}},this.curplace=this.state.attr.curplace,this.datamode=this.state.attr.datamode,this.timeframe=this.state.attr.timeframe,this.showgroup=this.state.attr.showgroup,this.lastdate=(new Date).getTime(),this.date=0,this.start=this.lastdate,this.historyactive=!1,this.logo="Graafikud",this.chartoptions={chart:{zoomType:"x",spacingRight:20,maxZoom:36e5,marginRight:110,marginLeft:85},xAxis:{type:"datetime",gridLineWidth:1},plotOptions:{spline:{lineWidth:2,states:{hover:{lineWidth:2}},marker:{enabled:!1}},scatter:{lineWidth:0,marker:{radius:2}}},legend:{enabled:!1},series:[]},this.charts=[],this.chartorder=["temp","wind_speed","wind_dir"],this.months=["Jaanuar","Veebruar","Märts","Aprill","Mai","Juuni","Juuli","August","September","Octoober","November","Detsember"],this.weekdays=["Pühapäev","Esmaspäev","Teisipäev","Kolmapäev","Neljapäev","Reede","Laupäev"]}var w=window,doc=document;return State.prototype={save:function(){return localStorage&&localStorage.setItem(this.id,JSON.stringify(this.toJSON())),this},load:function(){return localStorage&&this.set(JSON.parse(localStorage.getItem(this.id))),this},set:function(opt){if(!opt)return this;var changed=!1;for(var a in this.attr)"id"!==a&&opt[a]&&opt[a]!==this.attr[a]&&(this.attr[a]="none"===opt[a]?"":opt[a],changed=!0,console.log(a+" "+opt[a]));return changed&&this.save(),this},get:function(name){return this.attr[name]||null},destroy:function(){return localStorage&&localStorage.removeItem(this.id),this},toJSON:function(){var ret={};for(var a in this.attr)"id"!==a&&(ret[a]=this.attr[a]);return ret}},App.prototype={reorder:function(div){var i,j,el=null,co=this.chartorder;div||(div=this.placeholder),$(div).children().each(function(k,l){for(i=0,j=l.childNodes.length;j>i;++i)if(el=l.childNodes[i],!el.classname||!el.className.match(/title/)){if(el.className&&el.className.match(/meta/))break;el=null}for(i=0,j=co.length;j>i;++i)l.insertBefore(doc.getElementById(co[i]+(k+1)),el)})},loadBase:function(div){var i,j,el=null,newel=null,co=this.chartorder;div||(div=this.placeholder),$(div).children().each(function(k,l){if(l.className&&l.className.match(/float/)){for(i=0,j=l.childNodes.length;j>i;++i)if(el=l.childNodes[i],!el.classname||!el.className.match(/title/)){if(el.className&&el.className.match(/meta/))break;el=null}for(i=0,j=co.length;j>i;++i)newel=doc.createElement("div"),newel.setAttribute("id",co[i]+(k+1)),newel.className="chart-frame"+(co[i].match(/_dir/)?2:1),l.insertBefore(newel,el)}})},dirs:function(dir){return dir>=0&&11.25>=dir||dir>=348.75&&360>=dir?"N":dir>11.25&&33.75>=dir?"NNE":dir>33.75&&56.25>=dir?"NE":dir>56.25&&78.75>=dir?"ENE":dir>78.75&&101.25>=dir?"E":dir>101.25&&123.75>=dir?"ESE":dir>123.75&&146.25>=dir?"SE":dir>146.25&&168.75>=dir?"SSE":dir>168.75&&191.25>=dir?"S":dir>191.25&&213.75>=dir?"SSW":dir>213.75&&236.25>=dir?"SW":dir>236.25&&258.75>=dir?"WSW":dir>258.75&&281.25>=dir?"W":dir>281.25&&303.75>=dir?"WNW":dir>303.75&&326.25>=dir?"NW":dir>326.25&&348.75>=dir?"NNW":void 0},ntof2p:function(num){return null===num||void 0===num?null:parseFloat(parseFloat(num).toFixed(1))},conv_kmh2ms:function(input){var t=1e3*parseFloat(input)/3600;return parseFloat(t.toFixed(1))},conv_mh2ms:function(input){var t=parseFloat(input)/2.23693629;return parseFloat(t.toFixed(1))},conv_knot2ms:function(input){var t=parseFloat(input)/1.9426;return parseFloat((t+639e-6*t).toFixed(1))},conv_ms2knots:function(input){var t=parseFloat(input)/.515;return parseFloat((t+639e-6*t).toFixed(1))},getWidth:function(i){return i=i||null,w.innerWidth?w.innerWidth:doc.documentElement&&doc.documentElement.clientWidth?doc.documentElement.clientWidth:doc.body&&doc.body.clientWidth?doc.body.clientWidth:i},getavg:function(input){if("[object Array]"!==Object.prototype.toString.call(input))return 0;for(var i=0,j=input.length,sum=0;j>i;i++)sum+=parseFloat(input[i]);return parseFloat((sum/j).toFixed(1))},getmax:function(input){if("[object Array]"!==Object.prototype.toString.call(input))return 0;for(var i=0,j=input.length,k=0,max=0;j>i;i++)k=parseFloat(input[i]),k>max&&(max=k);return max},setFrame:function(d){var x="";return d&&/^\d*d/.test(d)?(x=d.replace(/d*$/,""),this.timeframe=24*x*3600*1e3):d&&/^\d*h/.test(d)?(x=d.replace(/h*$/,""),this.timeframe=3600*x*1e3):d&&/^\d+$/.test(d)&&(this.timeframe=d),this.state.set({timeframe:this.timeframe}),!1},getFrame:function(){var f=parseInt(this.timeframe,10),t=f/864e5;return t%1===0?t+"d":(t=f/36e5,t%1===0?t+"h":f)},setCurPlace:function(d){return this.setPlace(d,"curplace"),!1},setEstPlace:function(d){return this.setPlace(d),!1},setPlace:function(d,name){name=name||"fcplace";var i,places=this[name+"s"]||this.fcplaces,j=(this[name]||this.fcplace,{});if(d)for(i in places)if(i===d){j[name]=this[name]=d;break}return this.state.set(j),!1},setGroup:function(d){if(""===d||/^(jarv|meri)$/.test(d)&&this.showgroup!==d){if(this.showgroup=d,this.state.set({showgroup:d?d:"none"}),!d)return!1;this.fcplaces[this.fcplace].group!==this.showgroup&&this.setEstPlace(this.nextPlace()),this.curplaces[this.curplace].group!==this.showgroup&&this.setCurPlace(this.nextCurPlace())}return!1},nextCurPlace:function(){return this.nextPlace("curplace")},nextPlace:function(name){name=name||"fcplace";var i,places=this[name+"s"]||this.fcplaces,place=this[name]||this.fcplace,p="",that=!1,j="";for(i in places)j||this.showgroup&&this.showgroup!==places[i].group||(j=i),that&&(this.showgroup&&this.showgroup!==places[i].group||(p=i,that=!1)),i===place&&(that=!0);return p||(p=j),p},setDate:function(d){var ret=0,cur=(new Date).getTime();d&&/^\d*-\d*-\d*/.test(d)?ret=new Date(d).getTime():d&&/^\d+$/.test(d)&&(ret=(new Date).getTime()-d),ret&&ret>cur&&(ret=cur),ret&&(this.historyactive=cur-36e5>ret?!0:!1,this.start=this.lastdate=this.date=ret)},getTimeStr:function(d,f,g){d=new Date(d);var ret="",dsep="."+(d.getMonth()<10?"0":"")+(d.getMonth()+1)+".";return f&&(dsep=". "+my.months[d.getMonth()].toLowerCase()+" "),ret=(d.getDate()<10?"0":"")+d.getDate()+dsep+d.getFullYear(),g||(ret+=" "+(d.getHours()<10?"0":"")+d.getHours()+":"+(d.getMinutes()<10?"0":"")+d.getMinutes()),ret}},my=void 0===w.ilm?new App:w.ilm,console.log(my.getTimeStr(my.date)+" "+my.timeframe),my}(ilm||{});!function(my){var w=window,$=w.$,Highcharts=w.Highcharts,updateinterval=6e4,options={},normalizeData=function(data,obj){var d;if(data&&data.data)$.each(data.data,function(a,b){d=1e3*parseInt(b.time_stamp,10),obj.avg_ws_series.data.push([d,my.ntof2p(b.avg_wind_speed)]),obj.max_ws_series.data.push([d,my.ntof2p(b.max_wind_speed)]),obj.avg_wd_series.data.push([d,my.ntof2p(b.avg_wind_direction)]),obj.max_wd_series.data.push([d,my.ntof2p(b.max_wind_direction)]),obj.avg_temp_series.data.push([d,my.ntof2p(b.avg_outdoor_temperature)]),obj.avg_dp_series.data.push([d,my.ntof2p(b.avg_dewpoint)]),obj.avg_wc_series.data.push([d,my.ntof2p(b.avg_windchill)]),obj.avg_rain_series.data.push([d,my.ntof2p(b.rain_1hour)]),obj.avg_humid_series.data.push([d,my.ntof2p(b.outdoor_humidity)]),obj.avg_press_series.data.push([d,my.ntof2p(b.avg_absolute_pressure)])}),data.data.length&&(my.lastdate=1e3*parseInt(data.data[data.data.length-1].time_stamp,10));else if(data){var c,e;$.each(data.split("\n"),function(a,b){b&&!b.match(/^--/)&&(c=b.split(/\s+?/),c[9]=!c[9]||c[9]<0?0:c[9],c[1].match(/5$/)?e=c:(my.lastdate=d=new Date(c[0].replace(/(\d\d\d\d)(\d\d)(\d\d)/,"$1/$2/$3")+" "+c[1]).getTime(),my.timeframe&&my.start-my.lastdate<=my.timeframe&&("emu"===my.curplace?(obj.avg_ws_series.data.push([d,my.conv_kmh2ms(my.ntof2p(e?my.getavg([c[7],e[7]]):c[7]))]),obj.max_ws_series.data.push([d,my.conv_kmh2ms(my.ntof2p(e?my.getmax([c[8],e[8]]):c[8]))]),obj.avg_wd_series.data.push([d,my.ntof2p(e?my.getavg([c[9],e[9]]):c[9])]),obj.avg_temp_series.data.push([d,my.ntof2p(e?my.getavg([c[2],e[2]]):c[2])]),obj.avg_dp_series.data.push([d,my.ntof2p(e?my.getavg([c[6],e[6]]):c[6])]),obj.avg_wc_series.data.push([d,my.ntof2p(e?my.getavg([c[3],e[3]]):c[3])]),obj.avg_rain_series.data.push([d,my.ntof2p(e?my.getavg([c[10],e[10]]):c[10])]),obj.avg_humid_series.data.push([d,my.ntof2p(e?my.getavg([c[5],e[5]]):c[5])]),obj.avg_press_series.data.push([d,my.ntof2p(e?my.getavg([c[11],e[11]]):c[11])])):/emhi/.test(my.curplace)?(c[4]=!c[4]||c[4]<-49?null:c[4],obj.avg_ws_series.data.push([d,my.ntof2p(e?my.getavg([c[7],e[7]]):c[7])]),obj.max_ws_series.data.push([d,my.ntof2p(e?my.getmax([c[8],e[8]]):c[8])]),obj.avg_wd_series.data.push([d,my.ntof2p(e?my.getavg([c[9],e[9]]):c[9])]),null!==c[4]&&obj.avg_temp_series.data.push([d,my.ntof2p(e?my.getavg([c[4],e[4]]):c[4])]),obj.avg_wc_series.data.push([d,my.ntof2p(e?my.getavg([c[3],e[3]]):c[3])]),obj.avg_wl_series.data.push([d,my.ntof2p(e?my.getavg([c[2],e[2]]):c[2])])):/mnt/.test(my.curplace)&&(obj.avg_ws_series.data.push([d,my.ntof2p(e?my.getavg([c[8],e[8]]):c[8])]),obj.max_ws_series.data.push([d,my.ntof2p(e?my.getmax([c[6],e[6]]):c[6])]),obj.avg_wd_series.data.push([d,my.ntof2p(e?my.getavg([c[7],e[7]]):c[7])]),null!==c[2]&&obj.avg_temp_series.data.push([d,my.ntof2p(e?my.getavg([c[2],e[2]]):c[2])]),obj.avg_rain_series.data.push([d,my.ntof2p(e?my.getavg([c[3],e[3]]):c[3])]),obj.avg_humid_series.data.push([d,my.ntof2p(e?my.getavg([c[4],e[4]]):c[4])]),obj.avg_dp_series.data.push([d,my.ntof2p(e?my.getavg([c[5],e[5]]):c[5])])))))})}};Highcharts.setOptions({global:{useUTC:!1},lang:{months:my.months,weekdays:my.weekdays}}),options.wind_speed=$.extend(!0,{},my.chartoptions,{title:{text:"Tuule kiirus"},yAxis:[{title:{text:null},min:0,minorGridLineWidth:1,gridLineWidth:1,alternateGridColor:null,labels:{formatter:function(){return this.value+"m/s"},style:{color:"#4572a7"}},plotBands:[{from:.3,to:1.5,color:"rgba(68, 170, 213, 0.1)",label:{text:"(0) tuulevaikus",style:{color:"#606060"}}},{from:1.5,to:3.3,color:"rgba(0, 0, 0, 0)",label:{text:"(1) vaikne tuul",style:{color:"#606060"}}},{from:3.3,to:5.5,color:"rgba(68, 170, 213, 0.1)",label:{text:"(2) kerge tuul",style:{color:"#606060"}}},{from:5.5,to:8,color:"rgba(0, 0, 0, 0)",label:{text:"(3) nõrk tuul",style:{color:"#606060"}}},{from:8,to:11,color:"rgba(68, 170, 213, 0.1)",label:{text:"(4) mõõdukas tuul",style:{color:"#606060"}}},{from:11,to:14,color:"rgba(0, 0, 0, 0)",label:{text:"(5) üsna tugev tuul",style:{color:"#606060"}}},{from:14,to:17,color:"rgba(68, 170, 213, 0.1)",label:{text:"(6) tugev tuul",style:{color:"#606060"}}},{from:17,to:21,color:"rgba(0, 0, 0, 0)",label:{text:"(7) vali tuul",style:{color:"#606060"}}}]},{linkedTo:0,gridLineWidth:0,labels:{formatter:function(){return my.conv_ms2knots(this.value)+"knots"},style:{color:"#4572a7"}},title:{text:null},opposite:!0}],tooltip:{shared:!0,valueSuffix:" m/s",xDateFormat:"%d.%m.%Y, %H:%M"}}),options.wind_dir=$.extend(!0,{},my.chartoptions,{title:{text:"Tuule suund"},yAxis:[{title:{text:null},min:0,max:360,tickInterval:45,plotBands:[{from:0,to:90,label:{text:"NE",style:{color:"#606060"}}},{from:90,to:180,label:{text:"SE",style:{color:"#606060"}}},{from:180,to:270,label:{text:"SW",style:{color:"#606060"}}},{from:270,to:360,label:{text:"NW",style:{color:"#606060"}}}]},{linkedTo:0,gridLineWidth:0,title:{text:null},min:0,max:360,tickInterval:45,opposite:!0}],tooltip:{shared:!0,valueSuffix:"°",xDateFormat:"%d.%m.%Y, %H:%M"}}),options.temp=$.extend(!0,{},my.chartoptions,{title:{text:"Temperatuur, õhurõhk ja -niiskus"},yAxis:[{labels:{formatter:function(){return this.value+"°C"}},style:{color:"#2f7ed8"},title:{text:null}},{gridLineWidth:0,labels:{formatter:function(){return this.value+"hPa"},style:{color:"#AA4643"}},title:{text:null},opposite:!0},{gridLineWidth:0,max:100,labels:{formatter:function(){return this.value+"%"},style:{color:"rgb(159,176,189)"}},title:{text:null},opposite:!0},{gridLineWidth:0,labels:{formatter:function(){return this.value+"mm"},style:{color:"#4572A7"}},title:{text:null}},{gridLineWidth:0,labels:{formatter:function(){return this.value+"cm"},style:{color:"#4572A7"}},title:{text:null}}],tooltip:{shared:!0,valueSuffix:"°C",xDateFormat:"%d.%m.%Y, %H:%M"},legend:{layout:"vertical",align:"left",x:80,verticalAlign:"top",y:40,floating:!0,backgroundColor:"#FFFFFF"}});var ajaxopt={delta:"2y",hours:6,res:"10m",wind_speed:1,dewpoint:1,outdoor_temperature:1,windchill:1,wind_direction:1,absolute_pressure:1,rain_1hour:1,outdoor_humidity:1},afterGetUrl=function(json){var d,d_series={data:[],type:"spline",lineWidth:2},s={};s.min_ws_series=$.extend(!0,{},d_series,{name:"Min"}),s.avg_ws_series=$.extend(!0,{},d_series,{name:"Keskmine"}),s.max_ws_series=$.extend(!0,{},d_series,{name:"Max",color:"#910000",dashStyle:"shortdot"}),s.min_wd_series=$.extend(!0,{},d_series,{type:"scatter",name:"Min",lineWidth:0}),s.avg_wd_series=$.extend(!0,{name:"Keskmine"},d_series),s.max_wd_series=$.extend(!0,{},d_series,{type:"scatter",name:"Max",lineWidth:0}),s.avg_temp_series=$.extend(!0,{color:"#2f7ed8",name:"Temperatuur",negativeColor:"red"},d_series),s.avg_press_series=$.extend(!0,{},d_series,{color:"#AA4643",type:"spline",lineWidth:2,dashStyle:"shortdot",yAxis:1,name:"Õhurõhk",tooltip:{valueSuffix:" hPa"}}),s.avg_humid_series=$.extend(!0,{},d_series,{color:"rgb(159,176,189)",type:"spline",lineWidth:2,dashStyle:"longdash",yAxis:2,name:"Õhuniiskus",tooltip:{valueSuffix:" %"}}),s.avg_rain_series=$.extend(!0,{},d_series,{color:"#4572A7",type:"column",lineWidth:0,yAxis:3,name:"Sademed",tooltip:{valueSuffix:" mm"}}),s.avg_dp_series=$.extend(!0,{},d_series,{lineWidth:1,name:"Kastepunkt",color:"#0d233a"}),s.avg_wc_series=$.extend(!0,{},d_series,{lineWidth:1,name:"Tuuletemp",color:"#8bbc21"}),s.avg_wl_series=$.extend(!0,{color:"#2f7ed8",name:"Veetase",negativeColor:"green",tooltip:{valueSuffix:" cm"}},d_series),normalizeData(json,s),options.wind_speed.series=null,options.wind_speed.series=[],options.wind_speed.series.push(s.avg_ws_series),options.wind_speed.series.push(s.min_ws_series),options.wind_speed.series.push(s.max_ws_series),d=new Date(my.lastdate),$("#curplace").html("Andmed <b>"+my.curplaces[my.curplace].name+"</b>").show(),$("#curtime").html(my.getTimeStr(d,1,my.historyactive?1:0)).show();var list=_.map(my.curplaces,function(a){return my.showgroup&&my.curplaces[a.id].group!==my.showgroup?void 0:'<li><a href="#" name="'+a.id+'" class="curplace-select'+(a.id===my.curplace?" active":"")+'">'+a.name+"</a></li>"}).join("");$("#curmenu").html(list),$("#cursel").show(),$(".curplace-select").on("click",function(){w.ilm.setCurPlace($(this).attr("name")),w.ilm.reload()}),options.wind_speed.title.text=s.avg_ws_series.data.length?" Tuule kiirus"+(my.historyactive?"":" [ <b>"+s.avg_ws_series.data[s.avg_ws_series.data.length-1][1]+"</b> m/s (pagid: <b>"+s.max_ws_series.data[s.max_ws_series.data.length-1][1]+"</b> m/s) ]"):"Tuule kiiruse andmed puuduvad",options.wind_dir.title.text=s.avg_wd_series.data.length?" Tuule suund"+(my.historyactive?"":" [ <b>"+s.avg_wd_series.data[s.avg_wd_series.data.length-1][1]+"</b> ° (<b>"+my.dirs(s.avg_wd_series.data[s.avg_wd_series.data.length-1][1])+"</b>) ]"):"Tuule suuna andmed puuduvad",options.temp.title.text=s.avg_temp_series.data.length||s.avg_wl_series.data.length?(s.avg_temp_series.data.length?" Temperatuur"+(my.historyactive?"":" [ <b>"+s.avg_temp_series.data[s.avg_temp_series.data.length-1][1]+"</b> °C ]")+",":"")+(s.avg_press_series.data.length?" Rõhk"+(my.historyactive?"":" [ <b>"+s.avg_press_series.data[s.avg_press_series.data.length-1][1]+"</b> hPa ]")+",":"")+(s.avg_humid_series.data.length?" Niiskus"+(my.historyactive?"":" [ <b>"+s.avg_humid_series.data[s.avg_humid_series.data.length-1][1]+"</b> % ]"):"")+(!s.avg_humid_series.data.length&&s.avg_wc_series.data?" Veetemperatuur"+(my.historyactive?"":" [ <b>"+s.avg_wc_series.data[s.avg_wc_series.data.length-1][1]+"</b> °C ]"):"")+(!s.avg_humid_series.data.length&&s.avg_wl_series.data?" Veetase"+(my.historyactive?"":" [ <b>"+s.avg_wl_series.data[s.avg_wl_series.data.length-1][1]+"</b> cm ]"):""):"Temperatuuri andmed puuduvad",options.wind_dir.series=null,options.wind_dir.series=[],options.wind_dir.series.push(s.avg_wd_series),options.wind_dir.series.push(s.min_wd_series),options.wind_dir.series.push(s.max_wd_series),options.temp.series=null,options.temp.series=[],options.temp.series.push(s.avg_rain_series),options.temp.series.push(s.avg_temp_series),options.temp.series.push(s.avg_dp_series),options.temp.series.push(s.avg_wc_series),options.temp.series.push(s.avg_humid_series),options.temp.series.push(s.avg_press_series),options.temp.series.push(s.avg_wl_series),options.wind_speed.chart.renderTo="wind_speed1",options.wind_dir.chart.renderTo="wind_dir1",options.temp.chart.renderTo="temp1",my.charts[0]=new Highcharts.Chart(options.wind_speed),my.charts[1]=new Highcharts.Chart(options.wind_dir),my.charts[2]=new Highcharts.Chart(options.temp);var host=/emhi/.test(my.curplace)?"ilmateenistus.ee":/emu/.test(my.curplace)?"energia.emu.ee":/mnt/.test(my.curplace)?"balticroads.net":"";$("#curmeta").html('<a href="http://'+host+my.curplaces[my.curplace].link+'" onclick="window.open(this.href);return false;">'+host.charAt(0).toUpperCase()+host.slice(1)+"</a>, andmed viimati uuendatud: "+my.getTimeStr(my.lastdate)+", Järgmine uuendus: "+my.getTimeStr(my.lastdate+updateinterval))},setTxtFileName=function(d){d=new Date(d);var daystr=d.getFullYear()+"-"+(d.getMonth()<9?"0":"")+(d.getMonth()+1)+"-"+(d.getDate()<10?"0":"")+d.getDate();return"ARC-"+daystr+".txt"},setEmuFileName=function(d){return"emu_data/"+setTxtFileName(d)},setEmhiFileName=function(d,place){return place=place.replace(/emhi_/,""),"emhi_data/"+place+"/"+setTxtFileName(d)},setMntFileName=function(d,place){return place=place.replace(/mnt_/,""),"mnt_data/"+place+"/"+setTxtFileName(d)};my.loadCur=function(){var d,now;now=d=my.date>0?new Date(my.date).getTime():(new Date).getTime();var json_full="",cb=function(d){"emu"===my.curplace?(ajaxopt={},my.dataurl=setEmuFileName(d)):/emhi/.test(my.curplace)?(ajaxopt={},my.dataurl=setEmhiFileName(d,my.curplace)):/mnt/.test(my.curplace)&&(ajaxopt={},my.dataurl=setMntFileName(d,my.curplace)),$.ajax({url:my.dataurl,data:ajaxopt}).always(function(json,type){/error|timeout/.test(type)||(json_full+=json),("emu"===my.curplace||/emhi/.test(my.curplace)||/mnt/.test(my.curplace))&&now>d-1+864e5?(d+=864e5,cb(d)):afterGetUrl(json_full)})};cb(d-my.timeframe)};var intval=0;return my.loadInt=function(interval){interval&&interval>1e4?updateinterval=interval:interval=updateinterval,my.loadCur(),0===my.date&&(clearInterval(intval),intval=setInterval(my.loadCur,interval))},my.reload=function(){my.loadInt()},my}(ilm||{}),function(my){function addPlotLine(chart,ts){void 0!==chart.xAxis&&chart.xAxis[0].addPlotLine({value:ts,color:"rgb(238, 154, 154)",width:1,id:"nowline"})}function removePlotLine(chart){void 0!==chart.xAxis&&chart.xAxis[0].removePlotLine("nowline")}function intPlotLine(chart,intval){var interval=6e4,now=(new Date).getTime();return clearInterval(intval),removePlotLine(chart),addPlotLine(chart,now),intval=setInterval(function(){removePlotLine(chart),addPlotLine(chart,now)},interval)}var w=window,$=w.$,Highcharts=w.Highcharts,updateinterval=6e4;Highcharts.setOptions({global:{useUTC:!1},lang:{months:my.months,weekdays:my.weekdays}});var wind_speed_options=$.extend(!0,{},my.chartoptions,{title:{text:"Tuule kiiruse prognoos"},yAxis:[{title:{text:"Tuule kiirus (m/s)"},min:0,gridLineWidth:1}],tooltip:{shared:!0,valueSuffix:" m/s",xDateFormat:"%d.%m.%Y, %H:%M"}}),wind_dir_options=$.extend(!0,{},my.chartoptions,{title:{text:"Tuule suuna prognoos"},yAxis:[{title:{text:"Tuule suund (°)"},min:0,max:360,tickInterval:45,plotBands:[{from:0,to:90,label:{text:"NE",style:{color:"#606060"}}},{from:90,to:180,label:{text:"SE",style:{color:"#606060"}}},{from:180,to:270,label:{text:"SW",style:{color:"#606060"}}},{from:270,to:360,label:{text:"NW",style:{color:"#606060"}}}]},{linkedTo:0,title:{text:null},min:0,max:360,tickInterval:45,opposite:!0}],tooltip:{shared:!0,valueSuffix:"°",xDateFormat:"%d.%m.%Y, %H:%M"}}),temp_options=$.extend(!0,{},my.chartoptions,{title:{text:"Temperatuuri, rõhu, niiskuse prognoos"},yAxis:[{labels:{formatter:function(){return this.value+"°C"}},title:{text:null}},{gridLineWidth:0,labels:{formatter:function(){return this.value+"hPa"},style:{color:"#89A54E"}},title:{text:null},opposite:!0},{gridLineWidth:0,max:100,labels:{formatter:function(){return this.value+"%"},style:{color:"#4572a7"}},title:{text:null},opposite:!0},{gridLineWidth:0,labels:{formatter:function(){return this.value+"mm"},style:{color:"#2f7ed8"}},title:{text:null}}],tooltip:{shared:!0,valueSuffix:"°C",xDateFormat:"%d.%m.%Y, %H:%M"},legend:{layout:"vertical",align:"left",x:80,verticalAlign:"top",y:40,floating:!0,backgroundColor:"#FFFFFF"}});my.loadEst=function(place){place=(place||my.fcplace||"tabivere")+"/",$.ajax({type:"get",url:"yr_data/"+place+"forecast_hour_by_hour.xml"}).done(function(xml){var d,$xml=$(xml),d_series={data:[],type:"spline",lineWidth:2},temp_series={data:[],type:"spline",lineWidth:2,labels:{style:{color:"#8bbc21"}},negativeColor:"red"},press_series={data:[],type:"spline",lineWidth:2,dashStyle:"shortdot",yAxis:1,tooltip:{valueSuffix:"hPa"},labels:{style:{color:"#AA4643"}}},humid_series={data:[],type:"spline",lineWidth:2,dashStyle:"longdash",yAxis:2,tooltip:{valueSuffix:"%"},labels:{style:{color:"rgb(159,176,189)"}}},rain_series={data:[],type:"column",lineWidth:0,yAxis:3,tooltip:{valueSuffix:"mm"},labels:{style:{color:"#4572A7"}}},yr_ws_series=$.extend(!0,{},d_series,{name:"Yr wind"}),yr_wd_series=$.extend(!0,{},d_series,{name:"Yr dir"}),yr_temp_series=$.extend(!0,{},temp_series,{color:"#2f7ed8",name:"Yr temperatuur"}),yr_press_series=$.extend(!0,{},press_series,{color:"#AA4643",name:"Yr rõhk"}),yr_rain_series=$.extend(!0,{},rain_series,{color:"#4572A7",type:"column",name:"Yr sademed",lineWidth:0}),yr_get_time=function(xml,name){return function(d){return new Date(d[1],d[2]-1,d[3],d[4],d[5],d[6])}((xml.find?xml.find(name).text():xml.getAttribute("from")).match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/))};$xml.find("tabular time").each(function(i,times){var yrd=yr_get_time(times,"from");d=yrd.getTime()+18e5,yr_ws_series.data.push([d,my.ntof2p($(times).find("windSpeed").attr("mps"))]),yr_wd_series.data.push([d,my.ntof2p($(times).find("windDirection").attr("deg"))]),yr_temp_series.data.push([d,my.ntof2p($(times).find("temperature").attr("value"))]),yr_press_series.data.push([d,my.ntof2p($(times).find("pressure").attr("value"))]),yr_rain_series.data.push([d,my.ntof2p($(times).find("precipitation").attr("maxvalue"))])}),wind_speed_options.series=null,wind_speed_options.series=[],wind_speed_options.series.push(yr_ws_series),wind_speed_options.chart.renderTo="wind_speed2",wind_dir_options.series=null,wind_dir_options.series=[],wind_dir_options.series.push(yr_wd_series),wind_dir_options.chart.renderTo="wind_dir2",temp_options.series=null,temp_options.series=[],temp_options.series.push(yr_rain_series),temp_options.series.push(yr_temp_series),temp_options.series.push(yr_press_series),temp_options.chart.renderTo="temp2";{var wg_ws_series=$.extend(!0,{},d_series,{name:"WindGuru tuul"}),wg_wg_series=$.extend(!0,{},d_series,{name:"WindGuru gust",dashStyle:"shortdot"}),wg_wd_series=$.extend(!0,{},d_series,{name:"WindGuru dir"}),wg_temp_series=$.extend(!0,{},temp_series,{color:"#8bbc21",name:"WindGuru temperatuur"}),wg_press_series=$.extend(!0,{},press_series,{name:"WindGuru rõhk"});$.extend(!0,{},humid_series,{name:"WindGuru niiskus",color:"rgb(159,176,189)"})}$.ajax({type:"get",url:"wg_data/"+place+"windguru_forecast.json",dataType:"jsonp",jsonp:"callback",jsonpCallback:"wg_data"}).done(function(json){for(var wg=json.fcst.fcst[3],wgd=function(d){return new Date(d[1],d[2]-1,d[3],d[4],d[5],d[6])}(wg.initdate.match(/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})/)),d=wgd.getTime()-60*(new Date).getTimezoneOffset()*1e3+18e5,t=0,i=0,j=wg.hours.length;j>i&&!(wg.hours[i]>72);++i)t=d+3600*wg.hours[i]*1e3,wg_ws_series.data.push([t,my.conv_knot2ms(wg.WINDSPD[i])]),wg_wg_series.data.push([t,my.conv_knot2ms(wg.GUST[i])]),wg_wd_series.data.push([t,my.ntof2p(wg.WINDDIR[i])]),wg_temp_series.data.push([t,my.ntof2p(wg.TMP[i])]),wg_press_series.data.push([t,my.ntof2p(wg.SLP[i])]);wind_speed_options.series.push(wg_wg_series),wind_speed_options.series.push(wg_ws_series),wind_dir_options.series.push(wg_wd_series),temp_options.series.push(wg_temp_series),temp_options.series.push(wg_press_series),my.charts[3]=new Highcharts.Chart(wind_speed_options),my.charts[4]=new Highcharts.Chart(wind_dir_options),my.charts[5]=new Highcharts.Chart(temp_options);var i1,i2,i3;i1=intPlotLine(my.charts[3],i1),i2=intPlotLine(my.charts[4],i2),i3=intPlotLine(my.charts[5],i3),$("#fctitle").html("Prognoos <b>"+my.fcplaces[my.fcplace].name+"</b> "+my.getTimeStr(wg.update_last,1)).show();var list=_.map(my.fcplaces,function(a){return my.showgroup&&my.fcplaces[a.id].group!==my.showgroup?void 0:'<li><a href="#" name="'+a.id+'" class="fcplace-select'+(a.id===my.fcplace?" active":"")+'">'+a.name+"</a></li>"}).join("");$("#fcmenu").html(list),$("#fcsel").show(),$(".fcplace-select").on("click",function(){w.ilm.setEstPlace($(this).attr("name")),w.ilm.reloadest()}),$("#yrmeta").html('<a href="http://www.yr.no/place/Estonia/'+my.fcplaces[my.fcplace].yrlink+'/hour_by_hour.html" onclick="window.open(this.href);return false;">Yr.no</a> andmed viimati uuendatud: '+my.getTimeStr(yr_get_time($xml,"lastupdate"))+", Järgmine uuendus: "+my.getTimeStr(yr_get_time($xml,"nextupdate"))),$("#wgmeta").html('<a href="http://www.windguru.cz/ee/?go=1&amp;sc='+my.fcplaces[my.fcplace].wglink+'&amp;wj=msd&amp;tj=c&amp;fhours=180&amp;odh=3&amp;doh=22" onclick="window.open(this.href);return false;">Windguru.cz</a> andmed viimati uuendatud: '+my.getTimeStr(wg.update_last)+", Järgmine uuendus: "+my.getTimeStr(wg.update_next))})})};var intval=0;return my.loadEstInt=function(interval){interval&&interval>1e4?updateinterval=interval:interval=updateinterval,my.loadEst(),clearInterval(intval),intval=setInterval(my.loadEst,interval)},my.reloadest=function(){my.loadEstInt()},my}(window.ilm||{}),function(my){{var w=window;w.$}return w.openNew=w.openNew||function(url){return w.open(url,"_new"),!1},my.lingid=my.lingid||{JSON:{list:[{name:"Ilmalingid",list:[{name:"EMHI",url:"http://www.ilmateenistus.ee/",list:[{href:"ilm/ilmavaatlused/vaatlusandmed/tuul/",title:"Ilmavaatlused - tuul",id:"emhi_kaart"},{href:"ilm/prognoosid/mudelprognoosid/eesti/#layers/tuul10ms,tuul10mb",title:"Prognoos - Suur Hirlam",id:"emhi_hirlam_suur"}]},{name:"WeatherOnline",url:"http://www.weatheronline.co.uk/",list:[{href:"marine/weather?LEVEL=3&LANG=en&MENU=0&TIME=18&MN=gfs&WIND=g005",title:"Soome Laht",id:"weatheronline_sl"}]},{name:"WindGuru",url:"http://www.windguru.cz/",list:[{href:"int/?go=1&amp;lang=ee&amp;wj=msd&amp;tj=c&amp;odh=3&amp;doh=22&amp;fhours=180&amp;vp=1&amp;pi=2&amp;pu=413733",title:"Eesti Meri",id:"windguru_meri"},{href:"int/?go=1&amp;lang=ee&amp;wj=msd&amp;tj=c&amp;odh=3&amp;doh=22&amp;fhours=180&amp;vp=1&amp;pi=1&amp;pu=413733",title:"Sisej&auml;rved",id:"windguru_jarved"},{href:"int/?go=1&amp;lang=ee&amp;sc=266923&amp;wj=msd&amp;tj=c&amp;odh=3&amp;doh=22&amp;fhours=180",title:"Saadj&auml;rv",id:"windguru_saadjarv"},{href:"int/?go=1&amp;lang=ee&amp;sc=192609&amp;wj=msd&amp;tj=c&amp;odh=3&amp;doh=22&amp;fhours=180",title:"V&otilde;rtsj&auml;rv",id:"windguru_vortsjarv"},{href:"int/?go=1&amp;lang=ee&amp;sc=365700&amp;wj=msd&amp;tj=c&amp;odh=3&amp;doh=22&amp;fhours=180",title:"Tartu",id:"windguru_tartu"}]},{name:"YR.no",url:"http://www.yr.no/place/Estonia/",list:[{href:"Tartumaa/Tartu/hour_by_hour.html",title:"Tartu",id:"yr_tartu"},{href:"Tartumaa/Tamme/hour_by_hour.html",title:"Tamme",id:"yr_tamme"},{href:"Jõgevamaa/Tabivere~793956/hour_by_hour.html",title:"Tabivere",id:"yr_tabivere"},{href:"Harjumaa/Tallinn/hour_by_hour.html",title:"Tallinn",id:"yr_tallinn"}]},{name:"GisMeteo.ru",url:"http://www.gismeteo.ru/towns/",list:[{href:"26231.htm",title:"P&auml;rnu",id:"gismeteo_parnu"},{href:"26038.htm",title:"Tallinn",id:"gismeteo_tallinn"},{href:"26242.htm",title:"Tartu",id:"gismeteo_tartu"}]},{name:"Meteo.pl",url:"http://new.meteo.pl/um/php/meteorogram_map_um.php?lang=en&ntype=0u",list:[{href:"&row=227&col=325",title:"Saadj&auml;rv",id:"meteopl_saadjarv"},{href:"&row=234&col=318",title:"Võrtsj&auml;rv",id:"meteopl_vortsjarv"},{href:"&row=213&col=332",title:"Peipsi Mustvee",id:"meteopl_peipsi"}]},{name:"Windfinder.com",url:"http://www.windfinder.com/forecast/",list:[{href:"aeksi_saadjaerv",title:"Saadj&auml;rv",id:"windfinder_saadjarv"},{href:"tartu_airport",title:"Tartu",id:"windfinder_tartu"},{href:"mustvee_peipus&wf_cmp=2",title:"Mustvee Peipsi",id:"windfinder_mustvee"}]},{name:"Muud",url:"http://",list:[{href:"d.naerata.eu/",title:"Naerata.eu",id:"naerata"},{href:"teeinfo.evenet.ee/?mapdatatype=9",title:"Teeinfo",id:"teeinfo"},{href:"surf.paper.ee/",title:"Surf.Paper.EE",id:"paper"},{href:"palts.com/a/et_EE/ilmajaam/",title:"Palts.COM",id:"palts"},{href:"ilm.zoig.ee/",title:"Zoig.EE",id:"zoig",app:"?k=516"},{href:"http://www.kalastusinfo.ee/sisu/ilm/ilm-peipsi-jarvel.php",title:"Peipsi Ilmajaamad",id:"kalastusinfo"},{href:"www.wunderground.com/global/stations/26242.html",title:"WUnderground Tartu",id:"wground"},{href:"http://www.timeanddate.com/worldclock/astronomy.html?n=242",title:"Päikesetõus/loojang",id:"sunclock"}]}]},{name:"Surfilingid",list:[{name:"Eesti",url:"http://",list:[{href:"www.surf.ee/chat/",title:"Surf.ee chat",id:"surfichat"},{href:"www.surf.ee/turg/",title:"Surf.ee turg",id:"surfiturg"},{href:"www.lesurf.ee/",title:"L&otilde;una surfarid",id:"lesurf"},{href:"www.purjelaualiit.ee/",title:"Eesti Purjelaualiit",id:"purjelaualiit"},{href:"www.gps-speedsurfing.com/",title:"GPS Speedsurfing",id:"gps-speedsurfing"}]}]}]},process:function(f,u){var t=this,s="",i=0,patt=new RegExp("^http");
if(u=void 0===u?"":u,null!==f.href&&f.href)s+="<li>",s+='<a href="'+(patt.test(f.href)===!1?u:"")+f.href+(f.title?'" title="'+f.title:"")+(f.id?'" id="'+f.id:"")+'" onclick="a=\''+(f.app?f.app:"")+"';return openNew(this.href+a);\">",s+=(f.name?f.name:f.title)+"</a></li>";else if(f.list){f.name&&(s+='<div class="lingid">',f.list[0].href||(s+='<div class="ok">'),s+=f.name,f.list[0].href||(s+="</div>")),f.url&&(s+="<ul>");for(i in f.list)s+=t.process(f.list[i],f.url);f.url&&(s+="</ul>"),f.name&&(s+="</div>")}return s}},my}(ilm||{}),function(w){var $=w.$,d=document,e=d.documentElement,g=d.getElementsByTagName("body")[0];w.ilm.popup="",w.ilm.Options=function(){var f=$("#lingid"),g=$("#sl"),html="",z="";g.html("Seaded (klikk varjamiseks)");return w.ilm.state.attr?(z=w.ilm.getFrame(),html+='<div><label for="timeframe">Ajaraam</label> <select onchange="ilm.setFrame(this.options[this.selectedIndex].value);ilm.reload();return false;" id="timeframe" name="timeframe"><option value="1d"'+("1d"===z?" selected":"")+'>1 päev</option><option value="2d"'+("2d"===z?" selected":"")+'>2 päeva</option><option value="3d"'+("3d"===z?" selected":"")+">3 päeva</option></select></div>",html+='<div><label for="history">Andmed</label> <select onchange="ilm.setCurPlace(this.options[this.selectedIndex].value);ilm.reload();return false;" id="history-sel" name="history-sel">',html+=_.map(w.ilm.curplaces,function(a){return'<option value="'+a.id+'" '+(a.id===w.ilm.curplace?" selected":"")+">"+a.name+"</option>"}).join(""),html+="</select></div>",html+='<div><label for="forecast">Ennustus</label> <select onchange="ilm.setEstPlace(this.options[this.selectedIndex].value);ilm.reloadest();return false;" id="forecast-sel" name="forecast-sel">',html+=_.map(w.ilm.fcplaces,function(a){return'<option value="'+a.id+'" '+(a.id===w.ilm.fcplace?" selected":"")+">"+a.name+"</option>"}).join(""),html+="</select></div>",html+='<div><label for="groups">Paikade grupid</label> <select onchange="ilm.setGroup(this.options[this.selectedIndex].value);ilm.reloadest();ilm.reload();return false;" id="groups-sel" name="groups-sel">',html+=_.map({none:{id:"",name:"--"},jarv:{id:"jarv",name:"Järved"},meri:{id:"meri",name:"Meri"}},function(a){return'<option value="'+a.id+'" '+(a.id===w.ilm.showgroup?" selected":"")+">"+a.name+"</option>"}).join(""),html+="</select></div>"):html="<div>Siia tulevad seaded</div>",f.html(html),!1},w.ilm.Lingid=function(){var f=$("#lingid"),g=$("#sl");return g.html("Lingid (klikk varjamiseks)"),f.html(w.ilm.lingid.process(w.ilm.lingid.JSON)),!1},w.ilm.Popup=function(name,cb){var v=$("#popup");if(!v)return!1;var b=$("#bghide"),y=w.innerHeight||e.clientHeight||g.clientHeight,act=v.attr("name");return act&&$("#ilm-"+act).removeClass("active"),name&&(!act||act&&act!==name)?(b.css({height:$(d).height(),position:"absolute",left:0,top:0}).show(),v.attr("name",name),$("#ilm-"+name).addClass("active"),cb&&cb.call(this,name),v.css({top:y/2-v.height()/2+$(w).scrollTop()}).show()):v.is(":visible")&&(v.hide(),b.hide(),v.attr("name","")),!1},$(d).ready(function(){$("#pagelogo").html(ilm.logo),$("#ilm-lingid").click(function(){w.ilm.Popup("lingid",w.ilm.Lingid)}),$("#ilm-seaded").click(function(){w.ilm.Popup("seaded",w.ilm.Options)}),$("#fctitle").on("click",function(){return w.ilm.setEstPlace(w.ilm.nextPlace()),w.ilm.reloadest(),!1}),$("#datepicker").datepicker({dateFormat:"yy-mm-dd",onSelect:function(dateText){w.ilm.setDate(dateText+"T00:00:00"),w.ilm.reload()}}),$("#curtime").on("click",function(){$("#datepicker").datepicker("show")}),$("#curplace").on("click",function(){return w.ilm.setCurPlace(w.ilm.nextCurPlace()),w.ilm.reload(),!1}),w.ilm.loadBase(),w.ilm.loadInt(6e4),w.ilm.loadEstInt(6e5),$("#backgr").css({display:"block"}),$(w).on("keydown",function(e){var obj=$("#popup");obj&&(27===e.keyCode||13===e.keyCode)&&w.ilm.Popup("lingid",w.ilm.Lingid)})})}(window);