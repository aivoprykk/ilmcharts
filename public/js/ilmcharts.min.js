/*!
 * Ilmcharts v1.2.1 (http://ilm.majasa.ee)
 * Copyright 2012-2022 Aivo Pruekk
 * Licensed under MIT (https://github.com/aivoprykk/ilmcharts/blob/master/LICENSE)
 */

if("undefined"==typeof jQuery)throw new Error("Ilmcharts's JavaScript requires jQuery");var ilm=function(my){"use strict";var w=window,doc=document,loc=w.location,$=w.$,_=w._,console=w.console,SunCalc=w.SunCalc;function State(defaults){defaults={id:"ilmchartsstore01",datamode:(defaults=defaults||{}).datamode||"emu",timeframe:defaults.timeframe||0,fcsources:defaults.fcsources||["wg","yr","em"],fcplace:defaults.fcplace||"aksi",curplace:defaults.curplace||"emu",chartorder:defaults.chartorder||["temp","wind_speed","wind_dir"],gridorder:defaults.gridorder||[],showgroup:defaults.showgroup||"",binded:defaults.binded||!1,linksasmenu:defaults.linksasmenu||!1,timezone:defaults.timezone||2,viewmode:defaults.viewmode||"cur",samplemode:defaults.samplemode||"table",sampletype:defaults.sampletype||"detail",fcsource:defaults.fcsource||"wg",fcmax:defaults.fcmax||72,fcshownight:defaults.fcshownight||!1};return this.id=defaults.id,this.attr=defaults,this}function App(placeholder){this.deffcmax=72,this.state=(new State).load(),this.placeholder=placeholder||"#container",this.dataurl="/cgi-bin/cpp/ilm/image.cgi?t=json",this.digits=1,this.graphs=["temp","wind_speed","wind_dir"],this.fcsources=this.state.attr.fcsources,this.fcsources_available=["yr","wg","em"],this.fcsource=this.state.attr.fcsource||"wg",this.fcmax=this.state.attr.fcmax||this.deffcmax,this.fcshownight=this.state.attr.fcshownight||!1,this.samplemode=this.state.attr.samplemode||"table",this.sampletype=this.state.attr.sampletype||"detail",this.viewmode=this.state.attr.viewmode||"cur",this.fcplace=this.state.attr.fcplace,this.timezone=this.state.attr.timezone,this.curplace=this.state.attr.curplace,this.datamode=this.state.attr.datamode,this.timeframe=this.state.attr.timeframe,this.showgroup=this.state.attr.showgroup,this.binded=this.state.attr.binded,this.linksasmenu=this.state.attr.linksasmenu,this.chartorder=this.state.attr.chartorder,this.fcsourcesdata={yr:{name:"Yr",url:"http://www.yr.no",datadir:"yr_data2",fc_file:"yr_forecast.json",datatype:"json"},wg:{name:"WindGuru",url:"http://www.windguru.cz",datadir:"wg_data",fc_file:"windguru_forecast.json",datatype:"json"},em:{name:"Ilmateenistus",url:"http://www.ilmateenistus.ee",datadir:"empg_data",fc_file:"empg_forecast.json",datatype:"json"}},this.histsourcesdata={emhi:"ilmateenistus.ee",emu:"energia.emu.ee",ut:"meteo.physic.ut.ee",zoig:"ilm.zoig.ee",arhiiv:"ilm.majasa.ee",mnt:"balticroads.net",flydog:"databuoys.sensornest.com"},this.fcplaces={tartu:{id:"tartu",name:"Tartu",wglink:"266923",yrlink:"2-588335",emlink:"793",group:"koht",bind:"tartu",location:[58.380756,26.723452]},aksi:{id:"aksi",name:"Äksi Saadjärv",wglink:"266923",yrlink:"2-592574",emlink:"9748",group:"saadjarv",bind:"arhiiv_saadjarv_saadjarve",location:[58.534918,26.643429]},uhmardu:{id:"uhmardu",name:"Uhmardu",yrlink:"2-793979",emlink:"8629",group:"koht",link:"",bind:"mnt_uhmardu",location:[58.640605,26.79186]},jogeva:{id:"jogeva",name:"Jõgeva",group:"koht",yrlink:"2-591902",emlink:"2262",link:"",bind:"mnt_jogeva",location:[58.764849,26.404618]},tamme:{id:"tamme",name:"Tamme Võrtsjärv",wglink:192609,yrlink:"2-588397",emlink:"8094",group:"vortsjarv-tamme",bind:"arhiiv_vortsjarv_tamme",location:[58.271306,26.134923]},joesuu:{id:"joesuu",name:"Jõesuu Võrtsjärv",wglink:692681,yrlink:"2-591907",emlink:"8864",group:"vortsjarv-joesuu",bind:"arhiiv_vortsjarv_joesuu",location:[58.386441,26.131942]},rapina:{id:"rapina",name:"Räpina Peipsi",wglink:183648,yrlink:"2-587468",emlink:"7216",group:"peipsi",bind:"arhiiv_peipsi_rapina",location:[58.124988,27.530086]},nina:{id:"nina",name:"Nina Peipsi",wglink:20401,yrlink:"2-589982",emlink:"5427",group:"peipsi",bind:"arhiiv_peipsi_nina",location:[58.598889,27.209722]},mustvee:{id:"mustvee",name:"Mustvee Peipsi",wglink:104337,yrlink:"2-590067",emlink:"5097",group:"peipsi",bind:"emhi_mustvee",location:[58.8475,26.951111]},pirita:{id:"pirita",name:"Pirita Tallinn",wglink:125320,yrlink:"2-10123592",emlink:"596",group:"meri",bind:"emhi_pirita",location:[59.471562,24.825608]},rohuneeme:{id:"rohuneeme",name:"Rohuneeme Viimsi",wglink:70524,yrlink:"2-588984",emlink:"7039",group:"meri",bind:"emhi_rohuneeme",location:[59.551945,24.794094]},haapsalu:{id:"haapsalu",previd:"topu",name:"Haapsalu",wglink:245713,yrlink:"2-794885",emlink:"183",group:"meri",bind:"emhi_haapsalu",location:[58.9578,23.4901]},parnu:{id:"parnu",name:"Pärnu",wglink:92781,yrlink:"2-589580",emlink:"624",group:"meri",bind:"emhi_parnu",location:[58.365958,24.526257]},haademeeste:{id:"haademeeste",name:"Häädemeeste",wglink:246420,yrlink:"2-592232",emlink:"1957",group:"meri",bind:"emhi_haademeeste",location:[58.071644,24.478816]},sorve:{id:"sorve",name:"Sõrve Saaremaa",wglink:108163,yrlink:"2-794645",emlink:"7950",group:"meri",bind:"emhi_sorve",location:[57.909984,22.055313]},orjaku:{id:"orjaku",name:"Orjaku Hiiumaa",wglink:92777,yrlink:"2-794840",emlink:"7950",group:"meri",bind:"emhi_orjaku",location:[58.76252573432038,22.799324608581074]},ristna:{id:"ristna",name:"Ristna Hiiumaa",wglink:96592,yrlink:"2-589003",emlink:"2561",group:"meri",bind:"emhi_ristna",location:[58.927304,22.041023]},loksa:{id:"loksa",name:"Loksa",wglink:108851,yrlink:"2-587445",emlink:"4471",group:"meri",bind:"emhi_loksa",location:[59.5872,25.6943]},dirhami:{id:"dirhami",name:"Dirhami",wglink:261785,yrlink:"2-796115",emlink:"1505",group:"meri",bind:"emhi_dirhami",location:[59.2133,23.5031]},paatsalu:{id:"paatsalu",name:"Paatsalu",wglink:479054,yrlink:"2-589749",emlink:"5801",group:"meri",bind:"emhi_paatsalu",location:[58.508902,23.663027]}},this.curplaces={arhiiv_saadjarv_saadjarve:{id:"arhiiv_saadjarv_saadjarve",cid:"",name:"Saadjärve Saadjärv",group:"saadjarv",link:"",bind:"aksi",location:[58.54048,26.68177]},flydog_aksi:{id:"flydog_aksi",name:"Äksi Saadjärv",cid:"",group:"saadjarv",link:"/saadjarve/",bind:"aksi",location:[58.534918,26.643429]},emu:{id:"emu",name:"EMU Tartu",cid:"",group:"tartu",link:"/weather",bind:"tartu",location:[58.388575,26.694013]},ut_tartu:{id:"ut_tartu",cid:"",name:"UT Tartu",group:"koht",link:"",bind:"tartu",location:[58.365945,26.690791]},arhiiv_vortsjarv_tamme:{id:"arhiiv_vortsjarv_tamme",cid:"",name:"Tamme Võrtsjärv",group:"vortsjarv-tamme",link:"",bind:"tamme",location:[58.271306,26.134923]},arhiiv_vortsjarv_joesuu:{id:"arhiiv_vortsjarv_joesuu",cid:"",name:"Jõesuu Võrtsjärv",group:"vortsjarv-joesuu",link:"",bind:"joesuu",location:[58.386441,26.131942]},arhiiv_peipsi_nina:{id:"arhiiv_peipsi_nina",cid:"",name:"Nina Peipsi",group:"peipsi-nina",link:"",bind:"nina",location:[58.598889,27.209722]},arhiiv_peipsi_rapina:{id:"arhiiv_peipsi_rapina",cid:"",name:"Räpina Peipsi",group:"peipsi-rapina",link:"",bind:"rapina",location:[58.124988,27.530086]},mnt_tamme:{id:"mnt_tamme",cid:"",name:"V-Rakke MNT",group:"vortsjarv",link:"",bind:"tamme",location:[58.331664,26.187807]},mnt_rapina:{id:"mnt_rapina",cid:"",name:"Räpina MNT",group:"peipsi",link:"",bind:"rapina",location:[57.957275,27.62602]},mnt_uhmardu:{id:"mnt_uhmardu",cid:"",name:"Uhmardu MNT",group:"koht",link:"",bind:"uhmardu",location:[58.640605,26.79186]},mnt_jogeva:{id:"mnt_jogeva",cid:"",name:"Jõgeva MNT",group:"koht",link:"",bind:"jogeva",location:[58.764849,26.404618]},emhi_mustvee:{id:"emhi_mustvee",cid:"mustvee",name:"Mustvee EMHI",group:"peipsi",link:"",bind:"mustvee",location:[58.84765,26.951025]},emhi_pirita:{id:"emhi_pirita",cid:"pirita",name:"Pirita EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"pirita",location:[59.471562,24.825608]},emhi_rohuneeme:{id:"emhi_rohuneeme",cid:"rohuneeme",name:"Rohuneeme EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"rohuneeme",location:[59.551945,24.794094]},emhi_haapsalu:{id:"emhi_haapsalu",previd:"emhi_topu",cid:"haapsalu-sadam",name:"Haapsalu EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"haapsalu",location:[58.9578,23.4901]},arhiiv_parnu_aloha:{id:"arhiiv_parnu_aloha",cid:"",name:"Pärnu Aloha",group:"meri",link:"",bind:"parnu",location:[58.371146,24.508807]},emhi_parnu:{id:"emhi_parnu",cid:"parnu",name:"Pärnu EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"parnu",location:[58.365958,24.526257]},emhi_haademeeste:{id:"emhi_haademeeste",cid:"haademeeste",name:"Häädemeeste EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"haademeeste",location:[58.071644,24.478816]},emhi_orjaku:{id:"emhi_orjaku",cid:"heltermaa",name:"Heltermaa EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"orjaku",location:[58.866845079804946,23.04607326381741]},emhi_sorve:{id:"emhi_sorve",cid:"montu",name:"Sõrve EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"sorve",location:[57.909984,22.055313]},emhi_ristna:{id:"emhi_ristna",cid:"ristna-2",name:"Ristna EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"ristna",location:[58.927304,22.041023]},emhi_loksa:{id:"emhi_loksa",cid:"loksa",name:"Loksa EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"loksa",location:[59.5872,25.6943]},emhi_dirhami:{id:"emhi_dirhami",cid:"dirhami",name:"Dirhami EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"dirhami",location:[59.2133,23.5031]},emhi_paatsalu:{id:"emhi_paatsalu",cid:"virtsu",name:"Virtsu EMHI",group:"meri",link:"/meri/vaatlusandmed/",bind:"paatsalu",location:[58.508902,23.663027]}},this.addDst=this.isDst(),this.lastdate=this.getTime(),this.date=0,this.start=this.lastdate,this.historyactive=!1,this.logo="Ilmainfo",this.chartoptions={chart:{zoomType:"x",spacingRight:20,maxZoom:36e5,marginRight:110,marginLeft:85,credits:{enabled:!1}},xAxis:{type:"datetime",gridLineWidth:1,dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%a, %e.%m",week:"%a, %e.%m",month:"%b '%y",year:"%Y"}},plotOptions:{spline:{lineWidth:2,states:{hover:{lineWidth:2}},marker:{enabled:!1}},scatter:{lineWidth:0,marker:{radius:2}}},legend:{enabled:!1},series:[],responsive:{rules:{condition:{minWidth:450}}}},this.charts=[],this.months=["Jaanuar","Veebruar","Märts","Aprill","Mai","Juuni","Juuli","August","September","Oktoober","November","Detsember"],this.weekdays=["Pühapäev","Esmaspäev","Teisipäev","Kolmapäev","Neljapäev","Reede","Laupäev"],this.shortweekdays=["P","E","T","K","N","R","L"],loc.hash&&this.hash_data()}function touchHandler(event){var touch=event.changedTouches[0],simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[event.type],!0,!0,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,!1,!1,!1,!1,0,null),touch.target.dispatchEvent(simulatedEvent),event.preventDefault()}function focusEvent(div){div.addEventListener("touchstart",touchHandler,!0),div.addEventListener("touchmove",touchHandler,!0),div.addEventListener("touchend",touchHandler,!0),div.addEventListener("touchcancel",touchHandler,!0)}State.prototype={save:function(){return localStorage&&localStorage.setItem(this.id,JSON.stringify(this.toJSON())),this},load:function(){return localStorage&&this.set(JSON.parse(localStorage.getItem(this.id))),this},set:function(opt){if(!opt)return this;var a,changed=!1;for(a in this.attr)"id"===a||!opt[a]&&"boolean"!=typeof opt[a]||opt[a]===this.attr[a]||(this.attr[a]="none"===opt[a]?"":opt[a],changed=!0,console.log(a+" "+opt[a]));return changed&&this.save(),this},get:function(name){return this.attr[name]||null},destroy:function(){return localStorage&&localStorage.removeItem(this.id),this},toJSON:function(){var a,ret={};for(a in this.attr)"id"!==a&&(ret[a]=this.attr[a]);return ret}},App.prototype={changed:"",hash_data:function(){var changed={};if(loc.hash){var a=loc.hash.substring(1).split(/[\&\|\/]/),i=0,j=a.length,places=Object.keys(this.fcplaces);if(j)for(;i<j;++i){var b=a[i].split("=");b[0]&&(/aeg/.test(b[0])&&b[1]||/\d*-\d*-\d/.test(b[0])?changed.aeg=b[1]||b[0]:/koht/.test(b[0])&&b[1]||0<=places.indexOf(b[0])?(this.setEstPlace(b[1]||b[0],"ei"),changed.place=b[1]||b[0]):(/raam/.test(b[0])&&b[1]||/\d*[dh]/.test(b[0]))&&(changed.raam=b[1]||b[0]))}}return this.setFrame(changed.raam,"ei","ei"),this.setDate(changed.aeg,"ei"),this.setEstPlace(changed.place,"ei"),!1},graph_name:function(name){return"wind_speed"===name?"Tuule kiirus":"wind_dir"===name?"Tuule suund":"Temperatuur"},reorder:function(div){var i,j,a,el=null,id=null,co=this.chartorder;div=div||this.placeholder,$(div).children().each(function(k,l){if(l.className&&/float/.test(l.className)){for(a=[],_.each(l.childNodes,function(i){i&&(j=i.className||"")&&(/meta/.test(j)&&(el=i),/movable/.test(j)&&a.push(i))}),_.each(a,function(i){l.removeChild(i)}),i=0,j=co.length;i<j;++i)(id=doc.getElementById(co[i]+(k+1)))||((id=doc.createElement("div")).setAttribute("id",co[i]+(k+1)),id.className="movable chart-frame"+(co[i].match(/_dir/)?2:1)),l.insertBefore(id,el);0===k?my.reload():my.reloadest()}})},loadBase:function(div,node){var i,j,el=null,newel=null,m=0,co=this.chartorder;div=div||this.placeholder,$(div).children().each(function(k,l){if(l.className&&l.className.match(/float/)){for(++m,i=0,j=l.childNodes.length;i<j;++i)if(!(el=l.childNodes[i]).classname||!/(title|datepicker)/i.test(el.className)){if(el.className&&el.className.match(/meta/))break;el=null}for(i=0,j=co.length;i<j;++i)(newel=doc.getElementById(co[i]+(node||m)))||((newel=doc.createElement("div")).setAttribute("id",co[i]+(node||m)),newel.className="movable chart-frame"+(co[i].match(/_dir/)?2:1),l.insertBefore(newel,el))}})},ready:function(e,fn){e.readyState?e.onreadystatechange=function(){"loaded"!==e.readyState&&"complete"!==e.readyState||(e.onreadystatechange=null,fn&&fn())}:e.onload=function(){fn&&fn()}},makeSortable:function(div,fn){var self=w.ilm,swp=$(div);swp.sortable&&(swp.each(function(i,a){focusEvent(a)}),swp.sortable({connectWith:div,stop:function(){var nl=swp.sortable("toArray",{attribute:"name"});fn?fn(nl):nl.join(":")!==self.state.attr.gridorder.join(":")&&self.state.set({gridorder:nl})}}).disableSelection(),swp.sortable("enable"))},makeUnSortable:function(swp){swp=$(swp);swp.sortable&&(swp.sortable("disable"),swp.each(function(i,div){(div=div).removeEventListener("touchstart",touchHandler,!0),div.removeEventListener("touchmove",touchHandler,!0),div.removeEventListener("touchend",touchHandler,!0),div.removeEventListener("touchcancel",touchHandler,!0)}))},map:null,markers:{},markertype:"custom",markerclass:null,googleMarkerClassCreate:function(){var map=w.google.maps;function gmp(position,bg){this.c={};var c=this.c;this.label={text:"",color:"gray",fontSize:"100%",wd:0},this.icon={strokeColor:"gray"},this.position=position,this.title=bg&&bg.title?bg.title:"",c.label=document.createElement("span"),c.label.classList.add("compass-label"),c.arrow=document.createElement("span"),c.arrow.classList.add("compass-arrow");bg=document.createElement("span");bg.classList.add("compass-bg"),c.div=document.createElement("span"),c.div.classList.add("compass"),c.div.classList.add("compass-container"),c.div.appendChild(c.label),c.div.appendChild(c.arrow),c.div.appendChild(bg),c.container=document.createElement("div"),c.container.classList.add("compass-bubble"),c.container.appendChild(c.div),w.google.maps.OverlayView.preventMapHitsAndGesturesFrom(c.container)}return(gmp.prototype=Object.create(map.OverlayView.prototype)).onAdd=function(){this.getPanes().floatPane.appendChild(this.c.container)},gmp.prototype.onRemove=function(){this.c.container.parentElement&&this.c.container.parentElement.removeChild(this.c.container)},gmp.prototype.draw=function(){var divPosition=this.getProjection().fromLatLngToDivPixel(this.position),display=Math.abs(divPosition.x)<4e3&&Math.abs(divPosition.y)<4e3?"block":"none";"block"==display&&(this.c.container.style.left=divPosition.x+"px",this.c.container.style.top=divPosition.y+"px"),this.c.container.style.display!==display&&(this.c.container.style.display=display)},gmp.prototype.setLabel=function(data){data&&(data.text&&(this.label.text=data.text),data.wd&&(this.label.wd=data.wd,this.c.arrow.style.transform="rotate("+(data.wd-180)+"deg)"),data.color&&(this.label.color=data.color,this.c.label.style.color=data.color),data.fontSize&&(this.label.fontSize=data.fontSize,this.c.label.style.fontSize=data.fontSize),this.c.label.innerHTML=data.text||"0")},gmp.prototype.getLabel=function(){return this.label},gmp.prototype.setIcon=function(obj){obj&&obj.strokeColor&&(/rgb/.test(obj.strokeColor)?this.icon.strokeColor=obj.strokeColor.replace(/rgba?\(([0-9]+),(?:\s+)?([0-9]+),(?:\s+)?([0-9]+).+$/,"rgba($1,$2,$3,0.6)"):this.icon.strokeColor=obj.strokeColor,this.c.div.style.borderColor=this.icon.strokeColor)},gmp.prototype.getIcon=function(){return this.icon},gmp.prototype.addListener=function(name,cb){return this.c.container.addEventListener(name,cb)},gmp.prototype.getPosition=function(){return this.position},gmp},googleMarkerIcon:function(ws){return ws=ws||5,{path:w.google.maps.SymbolPath.CIRCLE,fillColor:"white",fillOpacity:.2,scale:Math.pow(2,0<ws?ws:3)/2,strokeColor:"gray",strokeWeight:.5}},addGoogleMarker:function(ws,pos,map,title,id){var marker;this.markers[id=id||"none"]?marker=this.markers[id]:(marker="custom"===this.markertype?(this.markerclass||(this.markerclass=this.googleMarkerClassCreate()),new this.markerclass(new w.google.maps.LatLng(pos.lat,pos.lng),{title:title})):new w.google.maps.Marker({position:pos,icon:this.googleMarkerIcon(ws),title:title||null,labelInBackground:!1}),this.markers[id]=marker),ws&&map&&marker.setLabel({text:ws+"",color:"black",wd:"0"}),marker.setMap(map)},initGoogleMap:function(datatable,markers){var keys=null,el=document.getElementById(datatable),datatable=$("#menu-container .table");if($(el).css({height:datatable.css("height")}),this.map=new w.google.maps.Map(el,{zoom:7,center:new w.google.maps.LatLng(58.824112,24.834173),mapTypeId:"terrain",styles:googleMapStyles1}),keys="[object Object]"===Object.prototype.toString.call(markers)?Object.keys(markers):keys)for(var i=0;i<keys.length;i++){var m=markers[keys[i]];this.addGoogleMarker(0,{lat:m.location[0],lng:m.location[1]},this.map,m.name,keys[i])}},loadMap:function(me){me=me&&me.target?$(me.target):$(me||".chart-container");return me&&(me.html('<div class="map-container"><div style="width:100%"><span class="map-info">&nbsp;</span></div><div class="mapbox" id="map"></div></div>'),this.initGoogleMap("map",this.curplaces)),!1},loadGrid:function(sorted_orig_gridorder){var i,j,self=this,el=null;if(sorted_orig_gridorder=sorted_orig_gridorder||(this.grid_placeholder||"menu-container"),el=doc.getElementById(sorted_orig_gridorder)){var n,html="<tbody>",gridorder=self.state.attr.gridorder,orig_gridorder=Object.keys(this.curplaces),sorted_orig_gridorder=Array.prototype.slice.call(orig_gridorder).sort();for(Array.prototype.slice.call(gridorder).sort()!==sorted_orig_gridorder&&self.state.set({gridorder:gridorder=orig_gridorder}),i=0,j=gridorder.length;i<j;++i)(n=this.curplaces[gridorder[i]])&&(html+='<tr id="grid-node-'+n.id+'" name="'+n.id+'" class="data-menu-row" style="background-color:white">',html+='<td class="sortable-is-active hide">-</td><td colspan="8">'+n.name+"</td>",html+="</tr>");html+="</tbody>",el.innerHTML="<div>&nbsp;</div>"+_.template(self.dataTableTemplate)({classes:"table sortable-table",thead:self.gridHeadTemplate,tbody:html}),self.ready(doc,function(){clearInterval(self.gridintval),self.fillGridLast(self),setInterval(self.fillGridLast,12e4,self),$(".data-menu-row").on("click",function(){_.each($(".data-menu-row"),function(a){a.style["background-color"]="white"}),$(this).css({"background-color":"rgb(236, 236, 236)"}),self.loadGraph(this,$(this).attr("name"))}),$(".data-menu-order").on("click",function(){$(this).hasClass("change")?($(this).removeClass("change"),self.makeSortable(".sortable-table tbody"),$(".sortable-is-active").each(function(i,a){$(a).removeClass("hide")})):($(this).addClass("change"),self.makeUnSortable(".sortable-table tbody"),$(".sortable-is-active").each(function(i,a){$(a).addClass("hide")}))})})}},loadGraph:function(tr,name){function func(el,tfc){tfc=tfc||{};var u=0,xlarge=1400<=self.getWidth(),s="";s+='<div class="chartbox" style="width:100%;height:100%;">',s+='<div class="chart-control-box" style="width:100%;position:relative;font-size:80%;">&nbsp;',"table"!==self.samplemode&&"cur"===self.viewmode&&(s+='<div id="graph-timeframe-control" style="position:absolute;z-index:10000;top:-7px;left:8px;">',s+='&nbsp;<span class="hist-length label label-default" name="4"> 4h </span>&nbsp;<span class="hist-length label label-default" name="6"> 6h </span>&nbsp;<span class="hist-length label label-default" name="12"> 12h </span>&nbsp;<span class="hist-length label label-default" name="24"> 24h </span>&nbsp;<span class="hist-length label label-default" name="48"> 2p </span>&nbsp;<span class="hist-length label label-default" name="72"> 3p </span>',s+="</div>"),s+='<div style="position:absolute;z-index:10000;left:5px;top:5px;">',s+='<span class="title-chart"></span>&nbsp;<span class="change-chart label label-default" name="cur">Ajalugu</span>&nbsp;<span class="change-chart label label-default" name="est">Prognoos</span>',s+="</div>",s+='<div style="position:absolute;z-index:10000;right:35px;top:5px;">',s+="table"===self.samplemode?'<span class="night-chart label label-default" name="'+(self.fcshownight?"fcsnf":"fcsnt")+'"> '+(self.fcshownight?"-":"+")+"Ööd</span>&nbsp;":"&nbsp;",s+='<span class="sample-chart label label-default" name="'+("table"===self.samplemode?"graph":"table")+'">Näita '+("table"===self.samplemode?"Graafikut":"Tabelit")+"</span>&nbsp;",s+="cur"!==self.viewmode||xlarge?'<span class="long-chart label label-default" name="'+("long"===self.sampletype?"detail":"long")+'">Näita '+("long"===self.sampletype?"Detailset":"Pikaajalist")+"</span>&nbsp;":"&nbsp;",s+="</div>",el.html(s+="</div>");var v=self.getWidth(null,el[0]);return self.timeframe||(self.timeframe=v<400?144e5:v<500?216e5:v<600?432e5:864e5),s='<div class="float two-lg"><div class="meta"></div><div class="fckhead fcright">',"table"!==self.samplemode&&(s+='<span class="label label-info"> '+tfc.name+"</span>"),s+="</div></div>",xlarge&&(s+='<div class="float two-lg"><div class="meta"></div><div class="fckhead fcleft">',"table"!==self.samplemode&&(s+='<span class="label label-info"> '+my.fcplaces[tfc.bind].name+"</span>"),s+="</div></div>"),(u=$(el).find(".chartbox")).append(s),self.loadBase(u[0],xlarge?null:"cur"===self.viewmode?1:2),"cur"!==self.viewmode&&!xlarge||w.ilm.setCurPlace(tfc.id),("cur"!==self.viewmode||xlarge)&&tfc.bind&&w.ilm.setEstPlace(tfc.bind),tfc=$("#graph-timeframe-control"),xlarge?(tfc.css({top:"5px"}),$("span.change-chart").css({display:"none"})):(tfc.css({top:"-7px"}),$('span.change-chart[name="'+self.viewmode+'"]').addClass("label-primary"),$(".change-chart").on("click",function(e){var a=$(this).attr("name");if(a===my.viewmode)return!1;self.loadGraph(e,a)})),$(".long-chart").on("click",function(e){var a=$(this).attr("name");if(a===my.sampletype)return!1;self.loadGraph(e,a)}),$(".sample-chart").on("click",function(e){var a=$(this).attr("name");if(a===my.samplemode)return!1;self.loadGraph(e,a)}),$(".night-chart").on("click",function(e){var a=$(this).attr("name");if("fcsnf"===a&&!my.fcshownight||"fcsnt"===a&&my.fcshownight)return!1;self.loadGraph(e,a)}),!1}var self=this,td="",n=self.curplaces[name]||self.curplaces[self.curplace],m=self.getWidth()<768?$(".chart-box"):$(".chartbox"),me=tr&&tr.target?$(tr.target):tr?$(tr):null,tr=!1;if(/(cur|est)$/.test(name)?(self.viewmode=name,self.state.set({viewmode:name}),tr=!0,$(".change-chart").off("click"),self.changed="viewmode"):/(detail|long)$/.test(name)?(self.sampletype=name,self.state.set({sampletype:name}),tr=!0,$(".long-chart").off("click"),self.changed="sampletype"):/(fcsnt|fcsnf)$/.test(name)?(self.fcshownight="fcsnt"===name,self.state.set({fcshownight:self.fcshownight}),tr=!0,$(".night-chart").off("click"),self.changed="fcshownight"):/(graph|table)$/.test(name)?(self.samplemode=name,self.state.set({samplemode:name}),tr=!0,self.changed="samplemode",$(".sample-chart").off("click")):td=name,m.length){if(me&&tr&&(me=m.prev()),_.each($(".chart-box"),function(a){a.remove()}),_.each($(".chartbox"),function(a){a.remove()}),td===self.curplace&&!tr)return _.each($(".data-menu-row"),function(a){a.style["background-color"]="white"}),self.loadMap(),!1;tr||(self.curplace=td)}if(me&&self.getWidth()<768){for(var tmp=me;tmp&&tmp.length&&!tmp.hasClass("data-menu-row")&&!tmp.hasClass("chart-container");)tmp=tmp.parent();return(me=tmp&&tmp.length?tmp:me).hasClass("data-menu-row")&&(tr=doc.createElement("tr"),td=doc.createElement("td"),tr.className="chart-box",tr.appendChild(td),td.setAttribute("colspan","6"),$(tr).insertAfter(me),me=$(td)),func(me,n)}return 768<=self.getWidth()&&func($(".chart-container"),n)},dataTableTemplate:'<table class="<%=classes%>" style="background-color:white;font-size:80%"><%=thead%><%=tbody%></table>',fcHeadTemplate:'<thead><%=inforows%><tr><th>Aeg</th><th>Tuul</th><th>Suund</th><th>Temp</th><th>Sademed</th><th class="hide-edge-xs">Rõhk</th></tr></thead>',fcRowTemplate:'<tr class="<%=night?"night":""%><%=night&&hide?" hide":""%>"><td><span class="day"><%=day%>&nbsp;</span><%=time%></td><td><span class="ws"<%if(wscolor){%> style="color:<%=wscolor%>"<%}%>><%=ws?ws:""%></span><%if(wg){%>/<span class="wg"<%if(wgcolor){%> style="color:<%=wgcolor%>"<%}%>><%=wg%></span><%}%></td><td><span class="arrow <%=dn%>"></span><%=wd?wd:""%></td><td><%=temp?temp:""%></td><td><%=rain?rain:""%></td><td class="hide-edge-xs"><%=press?press:""%></td></tr>',histHeadTemplate:'<thead><%=inforows%><tr><th>Aeg</th><th>Tuul</th><th>Suund</th><th>Temp</th><th>Vesi</th><th class="hide-lg">Veetemp</th><th class="hide-edge-xs">Sademed</th></tr></thead>',histRowTemplate:'<tr class="item <%=night?"night":""%>" id="<%=d.time%>"><td><span class="grid-cell-title">Aeg:&nbsp;</span><span class="grid-em"><span class="hide-edge"><span class="day"><%=day%>&nbsp;</span><%=date%>&nbsp;</span><span class="time-str"><%=time%></span></span></td><td><span class="grid-cell-title">Tuul:&nbsp;</span><span class="grid-em"><span class="avg_ws" style="color:<%=wscolor%>"><%=d.avg_ws%></span>/<span class="max_ws" style="color:<%=wgcolor%>"><%=d.max_ws%></span></span></td><td class="avg_wd" title="<%=dn%>"><span class="grid-cell-title">Suund:&nbsp;</span><span class="arrow <%=dn%>"></span><span class="grid-em"><%=d.avg_wd%></span></td><td class="avg_temp"><span class="grid-cell-title">Temp:&nbsp;</span><span class="grid-em"><%=d.avg_temp%></span></td><td class="avg_wl"><span class="grid-cell-title">Vesi:&nbsp;</span><span class="grid-em"><%=d.avg_wl%></span></td><td class="avg_wtemp hide-lg"><span class="grid-cell-title">Veetemp:&nbsp;</span><span class="grid-em"><%=d.avg_wtemp%></span></td><td class="hide-edge-xs avg_rain"><span class="grid-cell-title">Sademed:&nbsp;</span><span class="grid-em"><%=d.avg_rain%></span></td></tr>',gridHeadTemplate:'<thead><tr style="background-color:white"><th><span class="data-menu-order change label label-default" style="position:absolute;display:inline-block;background-color:white;border-radius:5px;color:black">+</span></th><th class="sortable-is-active hide"></th><th>Tuul</th><th>Suund</th><th>Temp</th><th>Vesi</th><th class="hide-lg">Veetemp</th><th class="hide-edge">Sademed</th><th class="hide-edge-xs">Aeg</th></tr></thead>',gridRowTemplate:'<td class="sortable-is-active hide">-</td><td><span class="grid-em"><%=first%><span class="hide-edge-xs">&nbsp;<%=last%></span></span></td><td><span class="grid-cell-title">Tuul:&nbsp;</span><span class="trend"><%=d.trend=="u"?"&uarr;":d.trend=="d"?"&darr;":"&nbsp;"%>&nbsp;</span><span class="grid-em" style="color:<%=wscolor%>"><span class="avg_ws"><%=d.avg_ws%></span>/<span class="max_ws" style="color:<%=wgcolor%>"><%=d.max_ws%></span></span></td><td class="avg_wd" title="<%=dn%>"><span class="grid-cell-title">Suund:&nbsp;</span><span class="arrow <%=dn%>"></span><span class="grid-em"><%=d.avg_wd%></span></td><td class="avg_temp"><span class="grid-cell-title">Temp:&nbsp;</span><span class="grid-em"><%=d.avg_temp%></span></td><td class="avg_wl"><span class="grid-cell-title">Vesi:&nbsp;</span><span class="grid-em"><%=d.avg_wl%></span></td><td class="avg_wtemp hide-lg"><span class="grid-cell-title">Veetemp:&nbsp;</span><span class="grid-em"><%=d.avg_wtemp%></span></td><td class="avg_rain hide-edge"><span class="grid-cell-title">Sademed:&nbsp;</span><span class="grid-em"><%=d.avg_rain%></span></td><td class="time hide-edge-xs"><span class="grid-cell-title">Aeg:&nbsp;</span><span class="grid-em"><span class="hide-edge hide-edge-lg"><span class="day"><%=day%>&nbsp;</span><%=date%>&nbsp;</span><span class="time-str"><%=time%></span></span></td>',chartContainerTemplate:'<div class="floa-t col-lg-6 col-md-12 col-xs-12"><div class="title btn-group"><a id="curplace" class="btn btn-default btn-xs navbar-btn">Andmed <b><%=title%></b></a><a id="curtime" class="btn btn-default btn-xs navbar-btn"><%=date%></a><a id="cursel" style="" data-toggle="dropdown" class="btn btn-default btn-xs navbar-btn dropdown-toggle"><span class="caret"></span></a><ul id="curmenu" role="menu" class="curmenu dropdown-menu"><li><a href="#" name="arhiiv_saadjarv_saadjarve" class="curplace-select active">Saadjärve Saadjärv</a></li><li><a href="#" name="flydog_aksi" class="curplace-select active">Saadjärv Äksi</a></li><li><a href="#" name="emu" class="curplace-select active">Tartu EMU</a></li><li><a href="#" name="ut_tartu" class="curplace-select">Tartu UT</a></li><li><a href="#" name="arhiiv_vortsjarv_joesuu" class="curplace-select">Võrtsjärv Jõesuu</a></li><li><a href="#" name="arhiiv_vortsjarv_tamme" class="curplace-select">Võrtsjärv Tamme</a></li><li><a href="#" name="mnt_tamme" class="curplace-select">V-Rakke MNT</a></li><li><a href="#" name="mnt_rapina" class="curplace-select">Räpina MNT</a></li><li><a href="#" name="mnt_uhmardu" class="curplace-select">Uhmardu MNT</a></li><li><a href="#" name="mnt_jogeva" class="curplace-select">Jõgeva MNT</a></li><li><a href="#" name="emhi_mustvee" class="curplace-select">Mustvee EMHI</a></li><li><a href="#" name="emhi_pirita" class="curplace-select">Pirita EMHI</a></li><li><a href="#" name="emhi_rohuneeme" class="curplace-select">Püünsi EMHI</a></li><li><a href="#" name="emhi_haapsalu" class="curplace-select">Haapsalu EMHI</a></li><li><a href="#" name="emhi_parnu" class="curplace-select">Pärnu EMHI</a></li><li><a href="#" name="emhi_haademeeste" class="curplace-select">Häädemeeste EMHI</a></li><li><a href="#" name="emhi_sorve" class="curplace-select">Sõrve EMHI</a></li><li><a href="#" name="emhi_ristna" class="curplace-select">Ristna EMHI</a></li><li><a href="#" name="emhi_heltermaa" class="curplace-select">Heltermaa EMHI</a></li></ul></div><input id="datepicker" type="text" style="visibility:hidden;height:0;width:0;padding:0;margin:0" class="hasDatepicker"><div class="meta"><div id="curmeta" class="ilm-meta"></div></div></div>',chart2Container:'<div class="floa-t col-lg-6 col-md-12 col-xs-12"><div class="title btn-group"><a id="fctitle" class="btn btn-default btn-xs navbar-btn"><%=title%></a><a id="fcsel" data-toggle="dropdown" class="btn btn-default btn-xs navbar-btn dropdown-toggle"><%=date%><span class="caret"></span></a><ul id="fcmenu" role="menu" class="fcmenu dropdown-menu"></ul></div><div class="meta"><div id="yrmeta" class="ilm-meta"><a href="http://www.yr.no/place/Estonia/Tartumaa/Äksi/hour_by_hour.html" onclick="window.open(this.href);return false;">Yr.no</a> andmed viimati uuendatud: 26.07.2017 22:32, Järgmine uuendus: 27.07.2017 11:00</div><div id="wgmeta" class="ilm-meta"><a href="http://www.windguru.cz/ee/?go=1&amp;sc=266923&amp;wj=msd&amp;tj=c&amp;fhours=180&amp;odh=3&amp;doh=22" onclick="window.open(this.href);return false;">Windguru.cz</a> andmed viimati uuendatud: 27.07.2017 01:24, Järgmine uuendus: 27.07.2017 01:24</div></div></div>',gridintval:0,getDayLetter:function(day){day=new Date(day).getDay();return this.weekdays[day][0]},fillGridLast:function(scope,div){var i,self=scope||this,now=new Date;if(div=div||(self.grid_placeholder||"menu-container"),doc.getElementById(div)){var func=function(url,n,e){var $e=$(e);$.ajax({type:"get",url:url}).always(function(json,type){/error|timeout/.test(type)||(self.normalizeData(n,json,function(obj){var deferred,time,first,last,wsbf,wgbf,marker,message,infowindow;obj&&(deferred=!1,time=self.getTimeStr(obj.time).split(/\s/),wgbf=n.name.lastIndexOf(" "),first=n.name.substring(0,wgbf+1),last=n.name.substring(wgbf+1,n.name.length),(deferred=216e5<now.getTime()-obj.time?!0:deferred)?$e.addClass("deferred"):$e.removeClass("deferred"),wsbf=self.bfscale(obj.avg_ws),wgbf=self.bfscale(obj.max_ws),$e.html(_.template(self.gridRowTemplate)({d:obj,first:first,last:last,day:self.getDayLetter(obj.time),date:time[0],time:time[1],dn:self.dirs(obj.avg_wd),wscolor:wsbf.label.style.color||"gray",wgcolor:wgbf.label.style.color||"gray",night:!1})),deferred||($e.find(".avg_ws").attr("title",wsbf.label.text),self.markers[n.id]&&((message=self.markers[n.id].getLabel()||{}).text=obj.avg_ws?""+obj.avg_ws:"0",message.color=wsbf.label.style.color||"gray",message.fontSize="80%",message.wd=obj.avg_wd||0,self.markers[n.id].setLabel(message)),$e.find(".max_ws").attr("title",wgbf.label.text),self.markers[n.id]&&((message=self.markers[n.id].getIcon()||{}).strokeColor=wgbf.label.style.color||"gray",self.markers[n.id].setIcon(message),message=$e.html().replace(/td>/gi,"div>").replace(/<td/gi,"<div"),marker=self.markers[n.id],message='<div class="infowindow">'+message+"</div>",infowindow=new w.google.maps.InfoWindow({content:message,zIndex:5e3}),marker&&marker.mclick&&w.google.maps.event.removeListener(marker.mclick),marker.mclick=marker.addListener("click",function(){return function(map){map=map.getMap();return null!=map}(infowindow)?(infowindow.close(),!1):void infowindow.open(marker.get("map"),marker)}),marker&&marker.mover&&w.google.maps.event.removeListener(marker.mover),marker.mover=marker.addListener("mouseover",function(){infowindow.open(marker.get("map"),marker)}),marker&&marker.mout&&w.google.maps.event.removeListener(marker.mout),marker.mout=marker.addListener("mouseout",function(){infowindow.close()})),obj.avg_temp<10&&$e.find(".avg_temp").addClass("chilli"),setTimeout(function(){$e.find(".time-str").css({color:"gray"})},6e4)))},1),$("#pagelogo").html(my.logo+' <span style="font-size:70%">'+my.getTimeStr(my.getTime())+"</span>"))})};for(i in self.curplaces){var n=self.curplaces[i];func(self.setHistDataUrl(n.id)+"?"+now.getTime(),n,"#grid-node-"+n.id)}}},colorasbf:function(bf,elf){bf=this.bfscale(bf);if(elf){elf=$(elf);return elf.css("color",bf.label.style.color),elf.attr("title",bf.label.text),!1}return{color:bf.label.style.color,title:bf.label.text}},dirs:function(dir){return 0<=dir&&dir<=11.25||348.75<=dir&&dir<=360?"n":11.25<dir&&dir<=33.75?"nne":33.75<dir&&dir<=56.25?"ne":56.25<dir&&dir<=78.75?"ene":78.75<dir&&dir<=101.25?"e":101.25<dir&&dir<=123.75?"ese":123.75<dir&&dir<=146.25?"se":146.25<dir&&dir<=168.75?"sse":168.75<dir&&dir<=191.25?"s":191.25<dir&&dir<=213.75?"ssw":213.75<dir&&dir<=236.25?"sw":236.25<dir&&dir<=258.75?"wsw":258.75<dir&&dir<=281.25?"w":281.25<dir&&dir<=303.75?"wnw":303.75<dir&&dir<=326.25?"nw":326.25<dir&&dir<=348.75?"nnw":void 0},bfscale:function(ws){return ws?ws<.3?{id:0,from:0,to:.3,color:"rgba(68, 170, 213, 0.1)",label:{text:"tuulevaikus",style:{color:"rgba(146, 147, 148, 1)"}}}:.3<=ws&&ws<1.6?{id:1,from:.3,to:1.5,color:"rgba(68, 170, 213, 0.1)",label:{text:"vaikne tuul",style:{color:"rgba(146, 147, 148, 1)"}}}:1.6<=ws&&ws<3.3?{id:2,from:1.5,to:3.3,color:"rgba(0, 0, 0, 0)",label:{text:"kerge tuul",style:{color:"rgba(97, 98, 98, 1)"}}}:3.3<=ws&&ws<5.5?{id:3,from:3.3,to:5.5,color:"rgba(68, 170, 213, 0.1)",label:{text:"nõrk tuul",style:{color:"rgba(202, 126, 97, 1)"}}}:5.5<=ws&&ws<8?{id:4,from:5.5,to:8,color:"rgba(0, 0, 0, 0)",label:{text:"mõõdukas tuul",style:{color:"rgba(25, 174, 49, 1)"}}}:8<=ws&&ws<11?{id:5,from:8,to:11,color:"rgba(68, 170, 213, 0.1)",label:{text:"üsna tugev tuul",style:{color:"rgba(22, 62, 205, 1)"}}}:11<=ws&&ws<14?{id:6,from:11,to:14,color:"rgba(0, 0, 0, 0)",label:{text:"tugev tuul",style:{color:"rgba(193, 18, 205, 1)"}}}:14<=ws&&ws<17.2?{id:7,from:14,to:17.2,color:"rgba(68, 170, 213, 0.1)",label:{text:"vali tuul",style:{color:"rgba(205, 14, 8, 1)"}}}:17.2<=ws&&ws<20.7?{id:8,from:17.2,to:20.7,color:"rgba(0, 0, 0, 0)",label:{text:"tormine tuul",style:{color:"rgba(159, 16, 84, 1)"}}}:20.7<=ws&&ws<24.5?{id:9,from:20.7,to:24.5,color:"rgba(0, 0, 0, 0)",label:{text:"torm",style:{color:"#FF9900"}}}:24.5<=ws?{id:10,from:24.5,to:28.4,color:"rgba(0, 0, 0, 0)",label:{text:"tugev torm",style:{color:"#FF6600"}}}:void 0:{id:1e3,color:"#bababa",label:{style:{color:"rgba(146, 147, 148, 1)"}}}},ntof2p:function(input){return"-"===input||""===input||null==input||"nan"===input?null:("[object String]"===Object.prototype.toString.call(input)&&/^0(\d+\.)/.test(input)&&(input=input.replace(/^0(\d+\.)/,"-$1")),parseFloat(parseFloat(input).toFixed(1)))},conv_kmh2ms:function(t){if("-"===t||""===t||null==t||"nan"===t)return null;t=1e3*parseFloat(t)/3600;return parseFloat(t.toFixed(1))},conv_mh2ms:function(t){if("-"===t||""===t||null==t||"nan"===t)return null;t=parseFloat(t)/2.23693629;return parseFloat(t.toFixed(1))},conv_knot2ms:function(t){if("-"===t||""===t||null==t||"nan"===t)return null;t=parseFloat(t)/1.9426;return parseFloat((t+639e-6*t).toFixed(1))},conv_ms2knots:function(t){if("-"===t||""===t||null==t||"nan"===t)return null;t=parseFloat(t)/.515;return parseFloat((t+639e-6*t).toFixed(1))},getWidth:function(i,el){return i=i||null,el&&el.clientWidth?el.clientWidth:w.innerWidth||(doc.documentElement&&doc.documentElement.clientWidth?doc.documentElement.clientWidth:doc.body&&doc.body.clientWidth?doc.body.clientWidth:i)},wdavg:function(wd,ws){if("[object Array]"!==Object.prototype.toString.call(wd))return 0;ws=ws||[];for(var ac,as,i=0,sins=0,coss=0,count=wd.length,num=count,c=0;i<count;++i)"-"!==wd[i]&&""!==wd[i]&&null!==wd[i]&&void 0!==wd[i]?(sins+=(ws[i]||1)*Math.sin(wd[i]*Math.PI/180),coss+=(ws[i]||1)*Math.cos(wd[i]*Math.PI/180)):--num;return ac=1/num*-1*coss,0==(as=1/num*-1*sins)?c=!(ac<0)&&0<ac?180:0:(c=90-180*Math.atan(ac/as)/Math.PI,0<as&&(c+=180)),c?parseFloat(c.toFixed(1)):0},getavg:function(input){if("[object Array]"!==Object.prototype.toString.call(input))return 0;for(var i=0,j=input.length,num=j,sum=0;i<j;i++)"-"!==input[i]&&""!==input[i]&&null!==input[i]&&void 0!==input[i]?("[object String]"===Object.prototype.toString.call(input[i])&&/^0(\d+\.)/.test(input[i])&&(input[i]=input[i].replace(/^0(\d+\.)/,"-$1")),sum+=parseFloat(input[i])):--num;return num?parseFloat((sum/num).toFixed(1)):null},getmax:function(input){if("[object Array]"!==Object.prototype.toString.call(input))return 0;for(var k,i=0,j=input.length,num=j,max=0;i<j;i++)"-"!==input[i]&&""!==input[i]&&null!==input[i]&&void 0!==input[i]?max<(k=parseFloat(input[i]))&&(max=k):--num;return num?max:null},setFrame:function(d,persist,load){var x="";return persist=persist||"ja",load=load||"ja",d&&/^\d*d/.test(d)?(x=d.replace(/d*$/,""),this.timeframe=24*x*3600*1e3):d&&/^\d*h/.test(d)?(x=d.replace(/h*$/,""),this.timeframe=3600*x*1e3):d&&/^\d+$/.test(d)&&(this.timeframe=d),"ja"===persist?this.state.set({timeframe:this.timeframe}):d||(this.timeframe=this.state.attr.timeframe),"ja"===load&&this.doReload("curplace"),!1},getFrame:function(){var f=parseInt(this.timeframe,10),t=f/864e5;return t%1==0?t+"d":(t=f/36e5)%1==0?t+"h":f},setTxtFileName:function(d){return d?"ARC-"+((d=new Date(d)).getFullYear()+"-"+(d.getMonth()<9?"0":"")+(d.getMonth()+1)+"-"+(d.getDate()<10?"0":"")+d.getDate())+".txt":"last.txt"},setHistDataUrl:function(place,d){var self=this;return/emu/.test(place)?"emu_data/"+self.setTxtFileName(d):place.replace(/^(ut|zoig|emhi|mnt|arhiiv|flydog|)_(.*)$/,function(match,dir,name){return dir+("arhiiv"===dir?"":"_data")+"/"+name+"/"+self.setTxtFileName(d)})},setCurPlace:function(d,persist,load){return this.setPlace(d,"curplace",persist,load),!1},setEstPlace:function(d,persist,load){return this.setPlace(d,"fcplace",persist,load),!1},setFcSource:function(fn){var self=w.ilm;return self.fcsources.indexOf(fn)<0||fn!==self.fcsource&&(self.fcsource=fn,self.state.set({fcsource:fn}),w.ilm.reloadest()),!1},setPlace:function(d,name,persist,load){persist=persist||"ja",load=load||"ja";var i,other,places=this[(name=name||"fcplace")+"s"]||this.fcplaces,j={},reload="";if("fcplace"===name&&d&&("saadjarv"===d?d="aksi":"vortsjarv"===d?d="tamme":"tallinn"===d&&(d="pirita")),d=d||this.state.attr[name])for(i in places)if(i===d){this[name]=d,this.state.attr[name]!==d&&(j[name]=d),reload=name,this.binded&&places[i].bind&&(this[other=/fc/.test(name)?"curplace":"fcplace"]=places[i].bind,this.state.attr[other]!==places[i].bind&&(j[other]=places[i].bind),reload="both");break}return reload&&("ja"===persist&&this.state.set(j),"ja"===load&&this.doReload(reload)),!1},nextCurPlace:function(){return this.nextPlace("curplace")},nextPlace:function(name){var i,places=this[(name=name||"fcplace")+"s"]||this.fcplaces,place=this[name]||this.fcplace,p="",that=!1,j="";for(i in places)j||this.showgroup&&this.showgroup!==places[i].group||(j=i),that&&(this.showgroup&&this.showgroup!==places[i].group||(p=i,that=!1)),i===place&&(that=!0);return p=p||j},doReload:function(reload){return w.ilm&&w.ilm.reload&&("both"===reload?(w.ilm.reloadest(),w.ilm.reload()):/fc/.test(reload)?w.ilm.reloadest():w.ilm.reload()),!1},setGroup:function(d){if(""===d||/^(jarv|meri)$/.test(d)&&this.showgroup!==d){if(this.showgroup=d,this.state.set({showgroup:d||"none"}),!d)return!1;this.fcplaces[this.fcplace].group!==this.showgroup&&this.setEstPlace(this.nextPlace()),this.curplaces[this.curplace].group!==this.showgroup&&this.setCurPlace(this.nextCurPlace())}return!1},setOrder:function(p){var o="[object String]"===Object.prototype.toString.call(p)?p.split(/[,:]/):p,p=this.chartorder;return"[object Array]"!==Object.prototype.toString.call(o)||o.join(":")===p.join(":")||(this.chartorder=o,this.state.set({chartorder:this.chartorder}),this.reorder()),!1},setBinded:function(value){return/(0|false)/.test(value)&&(value=!1),"boolean"==typeof(value=/(1|true)/.test(value)?!0:value)&&this.binded!==value&&(this.binded=value,this.state.set({binded:this.binded})),!1},setLinksAsMenu:function(value){return/(0|false)/.test(value)&&(value=!1),"boolean"==typeof(value=/(1|true)/.test(value)?!0:value)&&this.linksasmenu!==value&&(this.linksasmenu=value,this.state.set({linksasmenu:this.linksasmenu})),!1},setFcAsTable:function(value){return/(0|false)/.test(value)&&(value="graph"),/(1|true)/.test(value)&&(value="table"),this.samplemode!==value&&(this.samplemode=value,this.state.set({samplemode:this.samplemode}),this.reloadest()),!1},setFcShowNight:function(value){return/(0|false)/.test(value)&&(value=!1),/(1|true)/.test(value)&&(value=!0),this.fcshownight!==value&&(this.fcshownight=value,this.state.set({fcshownight:this.fcshownight}),this.reloadest()),!1},setDate:function(d,load){load=load||"ja";var ret=0,dd="",cur=this.getTime();d&&/^\d*[-.]\d*[-.]\d*/.test(d)?(d=4===(dd=(dd=d.split(/[\sT]/)[0]).split(/[-.]/,3))[0].length?dd[0]+"-"+dd[1]+"-"+dd[2]:dd[2]+"-"+dd[1]+"-"+dd[0],ret=this.getTime(d+="T23:59:59")):d&&/^\d+$/.test(d)?ret=this.getTime()-1e3*Number(d):d&&/^\d*h/.test(d)?ret=this.getTime()-3600*Number(d.replace(/h*$/,""))*1e3:d&&/^\d*d/.test(d)&&(ret=this.getTime()-24*Number(d.replace(/d*$/,""))*3600*1e3),(ret=!d||ret&&cur<ret?cur:ret)&&(this.historyactive=ret<cur-36e5,this.start=this.date=ret,"ja"===load&&this.doReload("curplace"))},isDst:function(){var dle=new Date,utcsec=dle.getTime(),dls=new Date(dle.getFullYear(),3,0),dle=new Date(dle.getFullYear(),10,0);return dls.setDate(dls.getDate()-dls.getDay()),dle.setDate(dle.getDate()-dle.getDay()),utcsec<dle.getTime()&&utcsec>=dls.getTime()},getOffsetSec:function(offset){return void 0===this.addDst&&(this.addDst=this.isDst()),36e5*((offset||this.timezone)+(this.addDst?1:0))},getTime:function(d,offset){return d=this.getGmtTime(d),new Date(d.getTime()+this.getOffsetSec(offset))},getGmtTime:function(d){return d=d?new Date(d):new Date,new Date(d.getTime()+6e4*d.getTimezoneOffset())},getTimeStr:function(d,f,g){var month=(d=d?new Date(d):this.getTime()).getMonth();if(!/\d/.test(month))return ret;var ret="",dsep="."+(month<9?"0":"")+(month+1)+".";return f&&(dsep=". "+my.months[month].toLowerCase()+" "),ret=(d.getDate()<9?"0":"")+d.getDate()+dsep+d.getFullYear(),g||(ret+=" "+(d.getHours()<10?"0":"")+d.getHours()+":"+(d.getMinutes()<10?"0":"")+d.getMinutes()),ret},viitedTemplate:function(div){return div&&(div="[object String]"===Object.prototype.toString.call(div)?$(div):div).html(""),""},settingTemplate:function(swp){var z,html="";return my.state.attr&&(html+='<form class="setting-form" style="width:320px;"><div><label for="timeframe">Ajaraam</label> <select class="form-control input-sm" onchange="ilm.setFrame(this.options[this.selectedIndex].value);ilm.reload();return true;" id="timeframe" name="timeframe"><option value="12h"'+("12h"===(z=my.getFrame())?" selected":"")+'>12 tundi</option><option value="1d"'+("1d"===z?" selected":"")+'>1 päev</option><option value="2d"'+("2d"===z?" selected":"")+'>2 päeva</option><option value="3d"'+("3d"===z?" selected":"")+">3 päeva</option></select></div>",html+='<div><label for="history">Andmed</label> <select class="form-control input-sm" onchange="ilm.setCurPlace(this.options[this.selectedIndex].value);ilm.settingTemplate(\'#ilm-seaded-dropdown\');return false;" id="history-sel" name="history-sel">',html+=_.map(my.curplaces,function(a){if(!my.showgroup||my.curplaces[a.id].group===my.showgroup)return'<option value="'+a.id+'" '+(a.id===my.curplace?" selected":"")+">"+a.name+"</option>"}).join(""),html+="</select></div>",html+='<div><label for="forecast">Ennustus</label> <select class="form-control input-sm" onchange="ilm.setEstPlace(this.options[this.selectedIndex].value);ilm.settingTemplate(\'#ilm-seaded-dropdown\');return false;" id="forecast-sel" name="forecast-sel">',html+=_.map(my.fcplaces,function(a){if(!my.showgroup||my.fcplaces[a.id].group===my.showgroup)return'<option value="'+a.id+'" '+(a.id===my.fcplace?" selected":"")+">"+a.name+"</option>"}).join(""),html+="</select></div>",html+='<div><label for="groups">Ennustuse ja andmete seos</label> <select class="form-control input-sm" onchange="ilm.setBinded(this.options[this.selectedIndex].value);return false;" id="binding-sel" name="binding-sel">',html+=_.map({ei:{id:!1,name:"Ei ole seotud"},jah:{id:!0,name:"On seotud"}},function(a){return'<option value="'+a.id+'" '+(a.id===my.binded?" selected":"")+">"+a.name+"</option>"}).join(""),html+="</select></div>",html+='<div><label for="groups">Paikade grupid</label> <select class="form-control input-sm" onchange="ilm.setGroup(this.options[this.selectedIndex].value);ilm.settingTemplate(\'#ilm-seaded-dropdown\');return false;" id="groups-sel" name="groups-sel">',html+=_.map({none:{id:"",name:"--"},jarv:{id:"jarv",name:"Järved"},meri:{id:"meri",name:"Meri"}},function(a){return'<option value="'+a.id+'" '+(a.id===my.showgroup?" selected":"")+">"+a.name+"</option>"}).join(""),html+="</select></div>",html+='<div><label for="groups">Paigutus</label><div><div style="padding-bottom:3px;"><ul id="order-sel1" class="order itemlist drag-box">',html+=_.map(my.chartorder,function(a){return'<li class="drag-item"name="'+a+'">'+my.graph_name(a)+"</li>"}).join(""),html+='</ul></div><div><ul id="order-sel2" class="order itemlist drag-box">',html+=_.map(my.graphs,function(a){return my.chartorder.indexOf(a)<0?'<li class="drag-item" name="'+a+'">'+my.graph_name(a)+"</li>":""}).join(""),html+='</ul></div><div class="checkbox"><label>Näita viiteid menüüs <input type="checkbox" onclick="ilm.setLinksAsMenu(this.checked);return true;" id="linksasmenu" name="linksasmenu"></label></div>',html+='<div class="checkbox"><label>Näita ennustust tabelis <input type="checkbox" onclick="ilm.setFcAsTable(this.checked);return true;" id="samplemode" name="samplemode"></label></div>',html+='<div class="checkbox"><label>Näita öist ennustust <input type="checkbox" onclick="ilm.setFcShowNight(this.checked);return true;" id="fcshownight" name="fcshownight"></label></div>',html+="</form>"),swp&&((swp="[object String]"===Object.prototype.toString.call(swp)?$(swp):swp).html(html),(swp=$(".itemlist")).sortable&&(swp.each(function(i,a){focusEvent(a)}),$(".itemlist").sortable({connectWith:".itemlist",stop:function(){var nl=$("#order-sel1").sortable("toArray",{attribute:"name"});nl.join(":")!==w.ilm.chartorder.join(":")&&w.ilm.setOrder(nl)}}).disableSelection()),w.ilm.linksasmenu&&$("#linksasmenu").attr({checked:"checked"}),"table"===w.ilm.samplemode&&$("#samplemode").attr({checked:"checked"})),html},normalizeData:function(place,data,fn,last,start){var b,d,lastdate,prev=null,obj=null;if(!fn)return 0;if(place&&place.id&&(place=place.id),data&&data.data){for(i=last?data.data.length-2:0,j=data.data.length,k=data.data.length-1;i<j;++i)i<0||(b=data.data[i],prev=obj,(obj=my.rowParser(place,b)).trend=prev?prev.ws_avg>obj.ws_avg?"d":prev.ws_avg<obj.ws_avg?"u":"s":"",last&&k!==i||fn(obj,j,i));j&&(lastdate=1e3*parseInt(data.data[j-1].time_stamp,10))}else if(data)for(var c,e,g,h=/^ut/.test(place),z=/\d+:\d[012346789]\s/.test(data),reg=new RegExp(h?",\\s*":"\\s+?"),rtmp=data.split("\n"),rows=_.filter(rtmp,function(a){return a&&/^(\d\d)/.test(a)}),i=last?rows.length-2:0,j=rows.length,k=rows.length-1;i<j;++i)i<0||(b=rows[i])&&!/^(--|Aeg)/.test(b)&&((c=b.split(reg))[9]=!c[9]||c[9]<0?0:c[9],!last&&(h&&/5:00$/.test(c[0])||!h&&z&&/5$/.test(c[1]))?e=c:(g=start-(lastdate=d=(h?new Date(c[0].replace(/(\d\d\d\d)-?(\d\d)-?(\d\d)/,"$1/$2/$3")):new Date(c[0].replace(/(\d\d\d\d)(\d\d)(\d\d)/,"$1/$2/$3")+" "+c[1])).getTime()),(!start||my.timeframe&&0<g&&g<=my.timeframe)&&(prev=obj,(obj=my.rowParser(place,c,d,e)).trend=prev?prev.avg_ws>obj.avg_ws?"d":prev.avg_ws<obj.avg_ws?"u":prev.max_ws>obj.max_ws?"d":prev.max_ws<obj.max_ws?"u":"s":"",last&&k!==i||fn(obj,j,i))));return lastdate},rowToSeries:function(o,obj){if(o)for(var p in o)"time"!==p&&obj[p+"_series"]&&obj[p+"_series"].data&&obj[p+"_series"].data.push([o.time,o[p]])},nightPlots:function(times,loc){if(!times)return null;for(var d,plots=[],x=0,night=[];0<=x;)d=new Date(0<x?x:times[0]),d=SunCalc.getTimes(d,loc[0],loc[1])||{},0===x?(x=times[0])<d.sunrise.getTime()&&(night[0]=x,night[1]=d.sunrise.getTime(),plots.push({color:"#eee",from:night[0],to:night[1],zIndex:0})):(night[1]=d.sunrise.getTime(),night[1]>times[1]&&(night[1]=times[1]),night[0]&&night[1]&&night[1]>night[0]&&plots.push({color:"#f9f9f9",from:night[0],to:night[1]})),night[0]=d.sunset.getTime(),(x+=864e5)>times[1]&&night[1]===times[1]&&(x=-1);return plots},rowParser:function(place,c,d,e){var r={},my=this;if(!c)return r;if(c.time_stamp)r.time=1e3*parseInt(c.time_stamp,10),r.avg_ws=my.ntof2p(c.avg_wind_speed),r.max_ws=my.ntof2p(c.max_wind_speed),r.avg_wd=my.ntof2p(c.avg_wind_direction),r.max_wd=my.ntof2p(c.max_wind_direction),r.avg_temp=my.ntof2p(c.avg_outdoor_temperature),r.avg_dp=my.ntof2p(c.avg_dewpoint),r.avg_wc=my.ntof2p(c.avg_windchill),r.avg_rain=my.ntof2p(c.rain_1hour),r.avg_humid=my.ntof2p(c.outdoor_humidity),r.avg_press=my.ntof2p(c.avg_absolute_pressure);else{for(var i=0,j=c.length;i<j;++i)c[i]=c[i]||null,e&&(e[i]=e[i]||null);r.time=d||new Date(c[0].replace(/(\d\d\d\d)(\d\d)(\d\d)/,"$1/$2/$3")+" "+c[1]).getTime(),/^ut/.test(place)?(r.time=d||new Date(c[0].replace(/(\d\d\d\d)-?(\d\d)-?(\d\d)/,"$1/$2/$3")).getTime(),c[1]=c[1]&&(c[1]<-49||49<c[1])?null:c[1],c[4]=c[4]&&(c[4]<0||49<c[4])?null:c[4],r.avg_ws=my.ntof2p(e?my.getavg([c[4],e[4]]):c[4]),r.avg_wd=my.ntof2p(e?my.wdavg([c[5],e[5]]):c[5]),null!==c[1]&&(r.avg_temp=my.ntof2p(e?my.getavg([c[1],e[1]]):c[1])),r.avg_rain=my.ntof2p(e?my.getavg([c[6],e[6]]):c[6]),r.avg_humid=my.ntof2p(e?my.getavg([c[2],e[2]]):c[2]),r.avg_press=my.ntof2p(e?my.getavg([c[3],e[3]]):c[3])):/(emu|zoig)/.test(place)?(r.avg_ws=my.conv_kmh2ms(my.ntof2p(e?my.getavg([c[7],e[7]]):c[7])),r.max_ws=my.conv_kmh2ms(my.ntof2p(e?my.getmax([c[8],e[8]]):c[8])),r.avg_wd=my.ntof2p(e?my.wdavg([c[9],e[9]]):c[9]),r.avg_temp=my.ntof2p(e?my.getavg([c[2],e[2]]):c[2]),r.avg_dp=my.ntof2p(e?my.getavg([c[6],e[6]]):c[6]),r.avg_wc=my.ntof2p(e?my.getavg([c[3],e[3]]):c[3]),r.avg_rain=my.ntof2p(e?my.getavg([c[10],e[10]]):c[10]),r.avg_humid=my.ntof2p(e?my.getavg([c[5],e[5]]):c[5]),r.avg_press=my.ntof2p(e?my.getavg([c[11],e[11]]):c[11])):/emhi/.test(place)?(c[5]=null===c[5]||void 0===c[5]||c[5]<-49?null:c[5],c[8]=c[8]&&(c[8]<0||49<c[8])?null:c[8],e&&(e[8]=e[8]&&(e[8]<0||49<e[8])?null:e[8]),c[9]=c[9]&&(c[9]<0||49<c[9])?null:c[9],e&&(e[9]=e[9]&&(e[9]<0||49<e[9])?null:e[9]),r.avg_ws=my.ntof2p(e?my.getavg([c[8],e[8]]):c[8]),r.max_ws=my.ntof2p(e?my.getmax([c[9],e[9]]):c[9]),r.avg_wd=my.ntof2p(e?my.wdavg([c[10],e[10]]):c[10]),null!==c[5]&&(r.avg_temp=my.ntof2p(e?my.getavg([c[5],e[5]]):c[5])),r.avg_wtemp=my.ntof2p(e?my.getavg([c[4],e[4]]):c[4]),r.avg_wl=my.ntof2p(e?my.getavg([c[2],e[2]]):c[2])):/mnt/.test(place)?(c[2]=null===c[2]||void 0===c[2]||c[2]<-49?null:c[2],c[8]=c[8]&&(c[8]<0||49<c[8])?null:c[8],e&&(e[8]=e[8]&&(e[8]<0||49<e[8])?null:e[8]),c[6]=c[6]&&(c[6]<0||49<c[6])?null:c[6],e&&(e[6]=e[6]&&(e[6]<0||49<e[6])?null:e[6]),r.avg_ws=my.ntof2p(e?my.getavg([c[8],e[8]]):c[8]),r.max_ws=my.ntof2p(e?my.getmax([c[6],e[6]]):c[6]),r.avg_wd=my.ntof2p(e?my.wdavg([c[7],e[7]]):c[7]),""!==c[2]&&(r.avg_temp=my.ntof2p(e?my.getavg([c[2],e[2]]):c[2])),""!==c[3]&&(r.avg_rain=my.ntof2p(e?my.getavg([c[3],e[3]]):c[3])),""!==c[4]&&(r.avg_humid=my.ntof2p(e?my.getavg([c[4],e[4]]):c[4])),""!==c[5]&&(r.avg_dp=my.ntof2p(e?my.getavg([c[5],e[5]]):c[5]))):/(arhiiv|flydog)/.test(place)&&(r.avg_ws=my.ntof2p(e?my.getavg([c[6],e[6]]):c[6]),r.max_ws=my.ntof2p(e?my.getmax([c[7],e[7]]):c[7]),r.avg_wd=my.ntof2p(e?my.wdavg([c[5],e[5]]):c[5]),""!==c[2]&&(r.avg_temp=my.ntof2p(e?my.getavg([c[2],e[2]]):c[2])),""!==c[4]&&(r.avg_dp=my.ntof2p(e?my.getavg([c[4],e[4]]):c[4])),""!==c[8]&&(r.avg_humid=my.ntof2p(e?my.getavg([c[8],e[8]]):c[8])),""!==c[9]&&(r.avg_press=my.ntof2p(e?my.getavg([c[9],e[9]]):c[9])))}return r}};var googleMapStyles1=[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.country",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.landcover",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.terrain",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.attraction",stylers:[{visibility:"off"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.government",stylers:[{visibility:"off"}]},{featureType:"poi.medical",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"poi.place_of_worship",stylers:[{visibility:"off"}]},{featureType:"poi.school",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.highway.controlled_access",stylers:[{visibility:"off"}]},{featureType:"road.local",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",stylers:[{visibility:"simplified"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{visibility:"off"}]},{featureType:"transit.station",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}];return my=void 0===w.ilm?new App:w.ilm}(ilm||{});window.$(function(){var $=window.$;window.WindBarbArrowHandler=window.WindBarbArrowHandler||{WindArrow:function(speed,direction,container,arrowWidth){"use strict";var i,index=0;if(this.speed=speed,this.direction=direction,this.trigDirection=direction+90,this.scale=arrowWidth/8,this.ten=0,this.five=0,this.fifty=0,$(container).append($(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr({height:2*arrowWidth,width:2*arrowWidth})),$("svg",container).append(document.createElementNS("http://www.w3.org/2000/svg","defs")),$("defs",container).append($(document.createElementNS("http://www.w3.org/2000/svg","clipPath")).attr("id","clip")),$("clipPath",container).append($(document.createElementNS("http://www.w3.org/2000/svg","rect")).attr({height:2*arrowWidth,width:2*arrowWidth})),$("svg",container).append($(document.createElementNS("http://www.w3.org/2000/svg","g")).attr("class","wind-arrow")),this.widget=$("svg",container),0<this.speed){for(this.path="",this.speed<=7?(this.longBar(),index=1):this.shortBar(),this.five=Math.floor(this.speed/5),3<=this.speed%5&&(this.five+=1),this.fifty=Math.floor(this.five/10),this.five-=10*this.fifty,this.ten=Math.floor(this.five/2),this.five-=2*this.ten,i=0;i<this.fifty;i++)this.addFifty(index+2*i);for(0<this.fifty&&(index+=2*(this.fifty-.5)),i=0;i<this.ten;i++)this.addTen(index+i);for(index+=this.ten,i=0;i<this.five;i++)this.addFive(index+i);this.path+="Z",this.widget.append(document.createElementNS("http://www.w3.org/2000/svg","g")),$("g",this.widget).append($(document.createElementNS("http://www.w3.org/2000/svg","path")).attr({d:this.path,"vector-effect":"non-scaling-stroke",transform:"translate("+arrowWidth+", "+arrowWidth+") scale("+this.scale+") rotate("+this.trigDirection+" 0 0)  translate(-8, -2)",class:"wind-arrow"}))}},shortBar:function(){"use strict";this.path+="M1 2 L8 2 "},longBar:function(){"use strict";this.path+="M0 2 L8 2 "},addTen:function(index){"use strict";this.path+="M"+index+" 0 L"+(index+1)+" 2 "},addFive:function(index){"use strict";this.path+="M"+(index+.5)+" 1 L"+(index+1)+" 2 "},addFifty:function(index){"use strict";this.path+="M"+index+" 0 L"+(index+1)+" 2 L"+index+" 2 L"+index+" 0 "}}}),function(my){"use strict";var w=window,$=w.$,_=w._,Highcharts=w.Highcharts,SunCalc=w.SunCalc,updateinterval=6e4,options={};Highcharts.setOptions({global:{useUTC:!1},lang:{months:my.months,weekdays:my.weekdays,shortWeekdays:my.shortweekdays}}),options.wind_speed=$.extend(!0,{},my.chartoptions,{title:{text:"Tuule kiirus"},yAxis:[{title:{text:null},tickInterval:5,minorGridLineWidth:1,gridLineWidth:1,alternateGridColor:null,min:0,labels:{formatter:function(){return this.value+"m/s"},style:{color:"#4572a7"}},plotBands:[{from:.3,to:1.5,color:"rgba(68, 170, 213, 0.1)",label:{text:"0bft",style:{color:"#606060"}}},{from:1.5,to:3.3,color:"rgba(0, 0, 0, 0)",label:{text:"1",style:{color:"#606060"}}},{from:3.3,to:5.5,color:"rgba(68, 170, 213, 0.1)",label:{text:"2",style:{color:"#606060"}}},{from:5.5,to:8,color:"rgba(0, 0, 0, 0)",label:{text:"3",style:{color:"#606060"}}},{from:8,to:11,color:"rgba(68, 170, 213, 0.1)",label:{text:"4",style:{color:"#606060"}}},{from:11,to:14,color:"rgba(0, 0, 0, 0)",label:{text:"5",style:{color:"#606060"}}},{from:14,to:17,color:"rgba(68, 170, 213, 0.1)",label:{text:"6",style:{color:"#606060"}}},{from:17,to:21,color:"rgba(0, 0, 0, 0)",label:{text:"7",style:{color:"#606060"}}}]},{linkedTo:0,gridLineWidth:0,labels:{formatter:function(){return my.conv_ms2knots(this.value)+"knots"},style:{color:"#4572a7"}},title:{text:null},opposite:!0}],tooltip:{shared:!0,valueSuffix:" m/s",xDateFormat:"%d.%m.%Y, %H:%M"}}),options.wind_dir=$.extend(!0,{},my.chartoptions,{title:{text:"Tuule suund"},yAxis:[{title:{text:null},min:0,max:360,tickInterval:45,plotBands:[{from:0,to:90,label:{text:"NE",style:{color:"#606060"}}},{from:90,to:180,label:{text:"SE",style:{color:"#606060"}}},{from:180,to:270,label:{text:"SW",style:{color:"#606060"}}},{from:270,to:360,label:{text:"NW",style:{color:"#606060"}}}]},{linkedTo:0,gridLineWidth:0,title:{text:null},min:0,max:360,tickInterval:45,opposite:!0}],tooltip:{shared:!0,valueSuffix:"°",xDateFormat:"%d.%m.%Y, %H:%M"}}),options.temp=$.extend(!0,{},my.chartoptions,{title:{text:"Temperatuur, õhurõhk ja -niiskus"},yAxis:[{tickInterval:5,labels:{formatter:function(){return this.value+"°C"}},style:{color:"#7cb5ec"},title:{text:null}},{gridLineWidth:0,tickInterval:10,labels:{formatter:function(){return this.value+"hPa"},style:{color:"#AA4643"}},title:{text:null},opposite:!0},{gridLineWidth:0,tickInterval:10,labels:{formatter:function(){return this.value+"%"},style:{color:"#C7C8CA"}},title:{text:null},opposite:!0},{gridLineWidth:0,tickInterval:2,labels:{formatter:function(){return this.value+"mm"},style:{color:"#4572A7"}},title:{text:null}},{gridLineWidth:0,tickInterval:10,labels:{formatter:function(){return this.value+"cm"},style:{color:"#8085e9"}},title:{text:null},opposite:!0}],tooltip:{shared:!0,valueSuffix:"°C",xDateFormat:"%d.%m.%Y, %H:%M"},legend:{layout:"vertical",align:"left",x:80,verticalAlign:"top",y:40,floating:!0,backgroundColor:"#FFFFFF"}});var get={now:0,dataseries:{},datalen:[0,0],getmax:function(hours){return hours=hours||my.histmax||24,(get.now||(new Date).getTime())+36e5*hours},update_len:function(date,i){1===i?(date<get.datalen[0]||!get.datalen[0])&&(get.datalen[0]=date):2===i&&(date>get.datalen[1]||!get.datalen[1])&&(get.datalen[1]=date)},donetable:function(where){var self=my,html="<tbody>";my.lastdate=my.normalizeData(my.curplace,where,function(obj,count,i){var time=my.curplaces[my.curplace].location,sun=SunCalc.getPosition(new Date(obj.time),time[0],time[1]),time=self.getTimeStr(obj.time).split(/\s/);html+=_.template(my.histRowTemplate)({d:obj,day:self.getDayLetter(obj.time),date:time[0],time:time[1],dn:self.dirs(obj.avg_wd),wscolor:self.bfscale(obj.avg_ws).label.style.color,wgcolor:self.bfscale(obj.max_ws).label.style.color,night:sun.altitude<0})},0,my.start);var metadata=$(html+="</tbody>"),hlinks='<tr class="fcontainer"><th colspan="7"><span class="hist-length" name="4"> 4h </span>&nbsp;<span class="hist-length" name="6"> 6h </span>&nbsp;<span class="hist-length" name="12"> 12h </span>&nbsp;<span class="hist-length" name="24"> 24h </span>&nbsp;<span class="hist-length" name="48"> 2p </span>&nbsp;<span class="hist-length" name="72"> 3p </span><span class="fchead right">'+my.curplaces[my.curplace].name+"</span></th></tr>",where=metadata.children(".item").get().reverse();metadata.html(where);new Date(my.lastdate);where=$("#"+my.chartorder[0]+"1");where.html(_.template(self.dataTableTemplate)({classes:"table",thead:_.template(self.histHeadTemplate)({inforows:hlinks}),tbody:metadata.html()})),where.css("height","100%");where.find(".table")[0];$("#"+my.chartorder[1]+"1").hide(),$("#"+my.chartorder[2]+"1").hide();metadata=get.histlink(my.curplace,my.lastdate,my.lastdate+updateinterval);get.dohmeta(my.curplace,metadata),$("#pagelogo").html(my.logo+' <span style="font-size:70%">'+my.getTimeStr(my.getTime())+"</span>"),where=$(".hist-length"),_.each(where,function(b){var d=$(b),b=d.attr("name"),b=3600*parseInt(b,10)*1e3;d.off("click"),d.on("click",function(e){var c=d.attr("name");if(3600*parseInt(c,10)*1e3===self.timeframe)return!1;self.setFrame(c+"h")}),b===my.timeframe?d.css("font-weight","600"):d.css("font-weight","400")})},done:function(where){var d_series={data:[],type:"spline",lineWidth:2},s={};s.avg_ws_series=$.extend(!0,{},d_series,{name:"Keskmine",color:"#7cb5ec",lineWidth:2}),s.max_ws_series=$.extend(!0,{},d_series,{name:"Max",color:"#910000",lineWidth:2,dashStyle:"shortdot"}),s.min_ws_series=$.extend(!0,{},d_series,{name:"Min",color:"#90ed7d",lineWidth:2}),s.min_wd_series=$.extend(!0,{},d_series,{type:"scatter",name:"Min",color:"#90ed7d",lineWidth:0}),s.avg_wd_series=$.extend(!0,{},d_series,{name:"Keskmine",color:"#7cb5ec",lineWidth:2}),s.max_wd_series=$.extend(!0,{},d_series,{type:"scatter",name:"Max",color:"#434348",lineWidth:0}),s.avg_temp_series=$.extend(!0,{},d_series,{name:"Temperatuur",color:"#7cb5ec",negativeColor:"red",lineWidth:2}),s.avg_dp_series=$.extend(!0,{},d_series,{name:"Kastepunkt",color:"#0d233a",lineWidth:1}),s.avg_wc_series=$.extend(!0,{},d_series,{name:"Tuuletemp",color:"#8bbc21",lineWidth:1}),s.avg_press_series=$.extend(!0,{},d_series,{name:"Õhurõhk",color:"#AA4643",lineWidth:2,type:"spline",dashStyle:"shortdot",yAxis:1,tooltip:{valueSuffix:" hPa"}}),s.avg_humid_series=$.extend(!0,{},d_series,{name:"Õhuniiskus",color:"#C7C8CA",lineWidth:1,type:"spline",dashStyle:"longdash",yAxis:2,tooltip:{valueSuffix:" %"}}),s.avg_rain_series=$.extend(!0,{},d_series,{name:"Sademed",color:"#4572A7",lineWidth:0,type:"column",yAxis:3,tooltip:{valueSuffix:" mm"}}),s.avg_wtemp_series=$.extend(!0,{},d_series,{name:"Veetemp",color:"#8d4653",lineWidth:2}),s.avg_wl_series=$.extend(!0,{},d_series,{name:"Veetase",color:"#8085e9",negativeColor:"#e4d354",lineWidth:2,type:"spline",yAxis:4,tooltip:{valueSuffix:" cm"}}),my.lastdate=my.normalizeData(my.curplace,where,function(o){var x=Object.keys(s)[0];x&&s[x].data&&s[x].data.length?get.datalen[1]=o.time:get.datalen[0]=o.time,my.rowToSeries(o,s)},0,my.start),options.wind_speed.series=null,options.wind_speed.series=[],options.wind_speed.series.push(s.min_ws_series),options.wind_speed.series.push(s.max_ws_series),options.wind_speed.series.push(s.avg_ws_series),where=new Date(my.lastdate),$("#curplace").html("Andmed <b>"+my.curplaces[my.curplace].name+"</b>").show(),$("#curtime").html(my.getTimeStr(where,1,my.historyactive?1:0)).show();where=_.map(my.curplaces,function(a){if(!my.showgroup||my.curplaces[a.id].group===my.showgroup)return'<li><a href="#" name="'+a.id+'" class="curplace-select'+(a.id===my.curplace?" active":"")+'">'+a.name+"</a></li>"}).join("");$("#curmenu").html(where),$("#cursel").show(),$(".curplace-select").on("click",function(){w.ilm.setCurPlace($(this).attr("name"))}),450<my.getWidth(null,$(".chartbox")[0])?(s.avg_ws_series.data.length?options.wind_speed.title.text=" Tuule kiirus"+(my.historyactive?"":" [ <b>"+s.avg_ws_series.data[s.avg_ws_series.data.length-1][1]+"</b> m/s (pagid: <b>"+(s.max_ws_series.data[s.max_ws_series.data.length-1]||["","-"])[1]+"</b> m/s) ]"):options.wind_speed.title.text="Tuule kiiruse andmed puuduvad",s.avg_wd_series.data.length?options.wind_dir.title.text=" Tuule suund"+(my.historyactive?"":" [ <b>"+s.avg_wd_series.data[s.avg_wd_series.data.length-1][1]+"</b> ° (<b>"+my.dirs(s.avg_wd_series.data[s.avg_wd_series.data.length-1][1])+"</b>) ]"):options.wind_dir.title.text="Tuule suuna andmed puuduvad",s.avg_temp_series.data.length||s.avg_wl_series.data.length?options.temp.title.text=(s.avg_temp_series.data.length?" Temperatuur"+(my.historyactive?"":" [ <b>"+s.avg_temp_series.data[s.avg_temp_series.data.length-1][1]+"</b> °C ]")+",":"")+(s.avg_press_series.data.length?" Rõhk"+(my.historyactive?"":" [ <b>"+s.avg_press_series.data[s.avg_press_series.data.length-1][1]+"</b> hPa ]")+",":"")+(s.avg_humid_series.data.length?" Niiskus"+(my.historyactive?"":" [ <b>"+s.avg_humid_series.data[s.avg_humid_series.data.length-1][1]+"</b> % ]"):"")+(!s.avg_humid_series.data.length&&s.avg_wtemp_series.data?" Veetemperatuur"+(my.historyactive?"":" [ <b>"+s.avg_wtemp_series.data[s.avg_wtemp_series.data.length-1][1]+"</b> °C ]"):"")+(!s.avg_humid_series.data.length&&s.avg_wl_series.data?" Veetase"+(my.historyactive?"":" [ <b>"+s.avg_wl_series.data[s.avg_wl_series.data.length-1][1]+"</b> cm ]"):""):options.temp.title.text="Temperatuuri andmed puuduvad"):(options.wind_speed.title.text="Tuule kiirus",options.wind_dir.title.text="Tuule suund",options.temp.title.text="Temperatuur, õhurõhk ja -niiskus"),options.wind_dir.series=null,options.wind_dir.series=[],options.wind_dir.series.push(s.min_wd_series),options.wind_dir.series.push(s.max_wd_series),options.wind_dir.series.push(s.avg_wd_series),options.temp.series=null,options.temp.series=[],options.temp.series.push(s.avg_temp_series),options.temp.series.push(s.avg_wc_series),options.temp.series.push(s.avg_rain_series),options.temp.series.push(s.avg_dp_series),options.temp.series.push(s.avg_humid_series),options.temp.series.push(s.avg_press_series),options.temp.series.push(s.avg_wl_series),options.temp.series.push(s.avg_wtemp_series),options.wind_speed.chart.renderTo="wind_speed1",options.wind_dir.chart.renderTo="wind_dir1",options.temp.chart.renderTo="temp1",0<=my.chartorder.indexOf("wind_speed")&&(my.charts[0]=new Highcharts.Chart(options.wind_speed)),0<=my.chartorder.indexOf("wind_dir")&&(my.charts[1]=new Highcharts.Chart(options.wind_dir)),0<=my.chartorder.indexOf("temp")&&(my.charts[2]=new Highcharts.Chart(options.temp));for(var k,l,where=my.curplaces[my.curplace].location,nightPlots=my.nightPlots(get.datalen,where),i=0;i<3;++i)for(k=0,l=nightPlots.length;k<l;++k)my.charts[i]&&my.charts[i].xAxis[0].addPlotBand(nightPlots[k]);where=get.histlink(my.curplace,my.lastdate,my.lastdate+updateinterval);get.dohmeta(my.curplace,where),$("#pagelogo").html(my.logo+' <span style="font-size:70%">'+my.getTimeStr(my.getTime())+"</span>");where=$(".hist-length");_.each(where,function(b){var d=$(b),islabel=d.attr("name"),b=3600*parseInt(islabel,10)*1e3;d.off("click"),d.on("click",function(e){var c=d.attr("name");if(3600*parseInt(c,10)*1e3===self.timeframe)return!1;my.setFrame(c+"h")});islabel=d.hasClass("label");islabel&&d.removeClass("label-primary"),b===my.timeframe?(islabel&&d.addClass("label-primary"),d.css("font-weight","600")):d.css("font-weight","400")})},histlink:function(title,last,next){var url=my.curplaces[title],link=url.link,xurl=url.cid,base=/emhi/.test(title)?"emhi":/emu/.test(title)?"emu":/flydog/.test(title)?"flydog":/^ut/.test(title)?"ut":/arhiiv/.test(title)?"arhiiv":/mnt/.test(title)?"mnt":"",url=base?my.histsourcesdata[base]:"",title=url.charAt(0).toUpperCase()+url.slice(1),xurl="http://"+url+link+("emhi"==base?xurl+"/":"");return _.template('<a onclick="window.open(this.href);return false;" href="<%=url%>"><%=title%><%if(last){%> <%=last%><%}if(next){%>, järgmine <%=next%><%}%></a>')({title:title,url:xurl,last:last?my.getTimeStr(last):null,next:next?my.getTimeStr(next):null})},dohmeta:function(box,data){var cnt=$("#curmeta"),cntn=null;cnt&&cnt.length?cnt.html(data):(cntn=1===(cnt=$(".meta")).length||2===cnt.length?$(cnt[0]):null)&&cntn.append('<div class="'+box+'-history-meta-info">'+data+"</div>")}};my.loadCur=function(url){var d,ajaxopt,now,json_full,cb;$("#"+my.chartorder[0]+"1").length&&(ajaxopt={},now=d=(0<my.date?new Date(my.date):my).getTime(),my.historyactive||(my.start=now),json_full="",(cb=function(d){my.dataurl=my.setHistDataUrl(my.curplace,d)+"?"+d,$.ajax({url:my.dataurl,data:ajaxopt}).always(function(cnt,type){/error|timeout/.test(type)||(json_full+=cnt);cnt=new Date(now).getDate()!==new Date(d).getDate();/(emhi|emu|mnt|zoig|arhiiv|flydog|ut_)/.test(my.curplace)&&cnt?cb(d+=864e5):((cnt=$(".meta"))[0]&&(cnt[0].innerHTML=""),"table"===my.samplemode?get.donetable(json_full):get.done(json_full))})})(d-my.timeframe))};var intval=0;my.loadInt=function(interval){interval&&1e4<interval?updateinterval=interval:interval=updateinterval,my.loadCur(),0===my.date&&(clearInterval(intval),intval=setInterval(my.loadCur,interval))},my.reload=function(){my.loadInt()}}(ilm||{}),function(my){"use strict";var w=window,$=w.$,_=w._,Highcharts=w.Highcharts,SunCalc=w.SunCalc,updateinterval=6e5;Highcharts.setOptions({global:{useUTC:!1},lang:{months:my.months,weekdays:my.weekdays,shortWeekdays:my.shortweekdays}});var wind_speed_options=$.extend(!0,{},my.chartoptions,{title:{text:"Tuule kiiruse prognoos"},yAxis:[{title:{text:"Tuule kiirus (m/s)"},tickInterval:5,gridLineWidth:1,min:0}],tooltip:{shared:!0,valueSuffix:" m/s",xDateFormat:"%d.%m.%Y, %H:%M"}}),wind_dir_options=$.extend(!0,{},my.chartoptions,{title:{text:"Tuule suuna prognoos"},yAxis:[{title:{text:"Tuule suund (°)"},min:0,max:360,tickInterval:45,plotBands:[{from:0,to:90,label:{text:"NE",style:{color:"#606060"}}},{from:90,to:180,label:{text:"SE",style:{color:"#606060"}}},{from:180,to:270,label:{text:"SW",style:{color:"#606060"}}},{from:270,to:360,label:{text:"NW",style:{color:"#606060"}}}]},{linkedTo:0,title:{text:null},min:0,max:360,tickInterval:45,opposite:!0}],tooltip:{shared:!0,valueSuffix:"°",xDateFormat:"%d.%m.%Y, %H:%M"}}),temp_options=$.extend(!0,{},my.chartoptions,{title:{text:"Temperatuuri, rõhu, niiskuse prognoos"},yAxis:[{tickInterval:5,labels:{formatter:function(){return this.value+"°C"}},title:{text:null}},{gridLineWidth:0,tickInterval:10,labels:{formatter:function(){return this.value+"hPa"},style:{color:"#AA4643"}},title:{text:null},opposite:!0},{gridLineWidth:0,tickInterval:10,labels:{formatter:function(){return this.value+"%"},style:{color:"#C7C8CA"}},title:{text:null},opposite:!0},{gridLineWidth:0,tickInterval:2,labels:{formatter:function(){return this.value+"mm"},style:{color:"#2f7ed8"}},title:{text:null}}],tooltip:{shared:!0,valueSuffix:"°C",xDateFormat:"%d.%m.%Y, %H:%M"},legend:{layout:"vertical",align:"left",x:80,verticalAlign:"top",y:40,floating:!0,backgroundColor:"#FFFFFF"}});function addPlotLine(chart,ts){void 0!==chart.xAxis&&chart.xAxis[0].addPlotLine({value:ts,color:"rgb(238, 154, 154)",width:1,id:"nowline"})}function removePlotLine(chart){void 0!==chart.xAxis&&chart.xAxis[0].removePlotLine("nowline")}function intPlotLine(chart,intval){var now=my.getTime();return clearInterval(intval),removePlotLine(chart),addPlotLine(chart,now),intval=setInterval(function(){removePlotLine(chart),addPlotLine(chart,now)},6e4)}var d_series={data:[],type:"spline",lineWidth:2},temp_series={data:[],type:"spline",lineWidth:2,labels:{style:{color:"#7cb5ec"}},negativeColor:"red"},press_series={data:[],type:"spline",lineWidth:2,dashStyle:"shortdot",yAxis:1,tooltip:{valueSuffix:"hPa"},labels:{style:{color:"#AA4643"}}},humid_series={data:[],type:"spline",lineWidth:2,dashStyle:"longdash",yAxis:2,tooltip:{valueSuffix:"%"},labels:{style:{color:"#C7C8CA"}}},rain_series={data:[],type:"column",lineWidth:0,yAxis:3,tooltip:{valueSuffix:"mm"},labels:{style:{color:"#4572A7"}}},fcsources=["yr","wg","em"],ajax_done=0,last_time=0,colors={wind:["#7cb5ec","#90ed7d","#ffcc99"],gust:["#aa4643","#f15c80","#800000"],dir:["#7cb5ec","#90ed7d","#ffcc99"],temp:["#7cb5ec","#90ed7d","#ffcc99"],press:["#aa4643","#f15c80","#800000"],rain:["#4572A7","#4572A7","#d1d1e0"],humid:["#C7C8CA","#C7C8CA","#C7C8CA"]},get={now:0,dataseries:{},datalen:[0,0],do:function(place,fcid,fillfn){if(get.now=(new Date).getTime(),place=place||my.fcplace||"tabivere",0===ajax_done&&(get.datalen=[0,0]),"table"===my.samplemode&&my.fcsource!==fcid)return++ajax_done===fcsources.length&&get.done(),!1;var fc=my.fcsourcesdata[fcid],fcidx=my.fcsources.indexOf(fcid),ajaxopt=fc.fc_file;"long"===my.sampletype&&/hour_by_hour/.test(ajaxopt)&&(ajaxopt="forecast.xml");ajaxopt={type:"get",url:fc.datadir+"/"+place+"/"+ajaxopt+"?"+get.now};"json"===fc.datatype&&"yr"!==fcid&&(ajaxopt.dataType="jsonp",ajaxopt.jsonp="callback",ajaxopt.jsonpCallback="wg"===fcid?fcid+"_data":"callback"),$.ajax(ajaxopt).always(function(data,metadata){/error|timeout/.test(metadata)||(get.dataseries=get.dataseries||{},get.dataseries[fcid]=get.dataseries[fcid]||{},get.dataseries[fcid][place]={},(metadata=get.dataseries[fcid][place]).ws_series=$.extend(!0,{},d_series,{name:fc.name+" wind",color:colors.wind[fcidx],lineWidth:2}),metadata.wd_series=$.extend(!0,{},d_series,{name:fc.name+" dir",color:colors.dir[fcidx],lineWidth:2}),metadata.wg_series=$.extend(!0,{},d_series,{name:fc.name+" gust",color:colors.gust[fcidx],lineWidth:2,dashStyle:"shortdot"}),metadata.temp_series=$.extend(!0,{},temp_series,{name:fc.name+" temperatuur",color:colors.temp[fcidx],lineWidth:2}),metadata.press_series=$.extend(!0,{},press_series,{name:fc.name+" rõhk",color:colors.press[fcidx],lineWidth:1}),metadata.rain_series=$.extend(!0,{},rain_series,{name:fc.name+" sademed",color:colors.rain[fcidx],type:"column",lineWidth:0}),metadata.humid_series=$.extend(!0,{},humid_series,{name:fc.name+" niiskus",color:colors.humid[fcidx],lineWidth:1}),fillfn&&fillfn(data,metadata,fcid),"graph"===my.samplemode&&(metadata.ws_series.data.length&&wind_speed_options.series.push(metadata.ws_series),metadata.wg_series.data.length&&wind_speed_options.series.push(metadata.wg_series),metadata.wd_series.data.length&&wind_dir_options.series.push(metadata.wd_series),metadata.humid_series.data.length&&temp_options.series.push(metadata.humid_series),metadata.rain_series.data.length&&temp_options.series.push(metadata.rain_series),metadata.press_series.data.length&&temp_options.series.push(metadata.press_series),metadata.temp_series.data.length&&temp_options.series.push(metadata.temp_series)),metadata=get.fclink(fcid,fc.url,my.fcplaces[place][fcid+"link"],fc.name,metadata.last,metadata.next),get.dometa(fcid,metadata)),++ajax_done===fcsources.length&&get.done()})},fclink:function(fc,url,placeid,placename,last,next){if(my.fcsources.indexOf(fc)<0||!url||!placeid||!placename)for(var ll=my.lingid.JSON.list,lm={},ln={},i=0,j=ll.length;i<j;++i)if("Ilmalingid"===ll[i].name){for(var k=0,l=(lm=ll[i].list).length;k<l;++k)if(lm[k].name===fc){for(var m=0,n=(ln=lm[k].list).length;m<n;++m)if(new RegExp(".+_("+my.fcplace+")").test(ln[m].id)){url=lm[k].url,placeid=ln[m].href,placename=lm[k].name;break}break}break}var fcurl="em"===fc?url+"/asukoha-prognoos/?coordinates="+placeid:"yr"===fc?url+"/en/details/table/"+placeid+"/":"wg"===fc?url+"/"+placeid:url+placeid;return _.template('<a onclick="window.open(this.href);return false;" href="<%=url%>"><%=title%><%if(last){%> <%=last%><%}if(next){%>, järgmine <%=next%><%}%></a>')({title:placename,url:fcurl,last:last?my.getTimeStr(last):null,next:next?my.getTimeStr(next):null})},do_em:function(data,dt,fcid){for(var from,d,fcmax=get.getmax(),em=(my.getOffsetSec(),data.forecast.tabular),em_get_time=function(d){return d=d.match(/(\d{4})-(\d{2})-(\d{2})[T\s](\d{2}):(\d{2}):(\d{2})/),new Date(d[1],d[2]-1,d[3],d[4],d[5],d[6])},i=0,j=em.time.length,k=j-1,initdate=0;i<j&&(d=(from=em_get_time(em.time[i]["@attributes"].from).getTime())+(em_get_time(em.time[i]["@attributes"].to).getTime()-from)/2,0===i&&(initdate=new Date(d)),(0===i||i===k||fcmax&&fcmax<d)&&get.update_len(d,0===i?1:i===k||fcmax&&fcmax<d?2:0),!(fcmax&&fcmax<d));++i)dt.ws_series.data.push([d,my.ntof2p(em.time[i].windSpeed["@attributes"].mps)]),dt.wd_series.data.push([d,my.ntof2p(em.time[i].windDirection["@attributes"].deg)]),dt.temp_series.data.push([d,my.ntof2p(em.time[i].temperature["@attributes"].value)]),dt.press_series.data.push([d,my.ntof2p(em.time[i].pressure["@attributes"].value)]),dt.rain_series.data.push([d,my.ntof2p(em.time[i].precipitation["@attributes"].value)]);from=initdate.getTime(),dt.last=from,dt.next=from+216e5},getmax:function(hours){return"long"===my.sampletype?0:(hours=hours||my.fcmax||my.deffcmax,(get.now||(new Date).getTime())+36e5*hours)},do_wg:function(offset,dt,fcid){for(var t,fcmax=get.getmax(),wg=offset.fcst.fcst[3],wg_get_time=function(d){return d=d.match(/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})/),new Date(d[1],d[2]-1,d[3],d[4],d[5],d[6])},offset=36e5*offset.fcst.utc_offset,d=wg_get_time(wg.initdate).getTime()+offset,i=0,j=wg.hours.length,k=j-1;i<j&&(t=d+36e5*wg.hours[i],(0===i||i===k||fcmax&&fcmax<t)&&get.update_len(t,0===i?1:i===k||fcmax&&fcmax<t?2:0),!(fcmax&&fcmax<t));++i)dt.ws_series.data.push([t,my.conv_knot2ms(wg.WINDSPD[i])]),dt.wg_series.data.push([t,my.conv_knot2ms(wg.GUST[i])]),dt.wd_series.data.push([t,my.ntof2p(wg.WINDDIR[i])]),dt.temp_series.data.push([t,my.ntof2p(wg.TMP[i])]),dt.press_series.data.push([t,my.ntof2p(wg.SLP[i])]),dt.humid_series.data.push([t,my.ntof2p(wg.RH[i])]),"graph"!==my.samplemode&&dt.rain_series.data.push([t,my.ntof2p(wg.PCPT[i])]);dt.last=new Date(wg.update_last.replace(/-/g,"/").replace(/\+.+/,"")).getTime()+offset,dt.next=new Date(wg.update_next.replace(/-/g,"/").replace(/\+.+/,"")).getTime()+offset,last_time=wg_get_time(wg.initdate).getTime()+offset},update_len:function(date,i){1===i?(date<get.datalen[0]||!get.datalen[0])&&(get.datalen[0]=date):2===i&&(date>get.datalen[1]||!get.datalen[1])&&(get.datalen[1]=date)},do_yr0:function($xml,dt,fcid){for(var fcmax=get.getmax(),$xml=$($xml),yr_get_time=function(d,attr){attr=d.find?d.find(attr).text():d.getAttribute(attr);return d=(attr||d.getAttribute("from")).match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/),new Date(d[1],d[2]-1,d[3],d[4],d[5],d[6])},nodes=$xml.find("tabular time"),i=0,j=nodes.length,k=j-1;i<j;++i){var times,d=yr_get_time(times=nodes[i],"from").getTime(),d=d+(yr_get_time(times,"to").getTime()-d)/2;if((0===i||i===k||fcmax&&fcmax<d)&&get.update_len(d,0===i?1:i===k||fcmax&&fcmax<d?2:0),fcmax&&fcmax<d)break;dt.ws_series.data.push([d,my.ntof2p($(times).find("windSpeed").attr("mps"))]),dt.wd_series.data.push([d,my.ntof2p($(times).find("windDirection").attr("deg"))]),dt.temp_series.data.push([d,my.ntof2p($(times).find("temperature").attr("value"))]),dt.press_series.data.push([d,my.ntof2p($(times).find("pressure").attr("value"))]),dt.rain_series.data.push([d,my.ntof2p($(times).find("precipitation").attr("value"))])}dt.last=yr_get_time($xml,"lastupdate").getTime(),dt.next=yr_get_time($xml,"nextupdate").getTime(),last_time=dt.last},do_yr:function(data,dt,fcid){for(var t,lo,op,fcmax=get.getmax(),yr=data.properties.timeseries,yr_get_time=function(xd){return new Date(xd)},i=(yr_get_time((yr[0]||{}).time).getTime(),0),j=yr.length,k=j-1;i<j&&(t=yr_get_time(((lo=yr[i])||{}).time).getTime()+0,(0===i||i===k||fcmax&&fcmax<t)&&get.update_len(t,0===i?1:i===k||fcmax&&fcmax<t?2:0),!(fcmax&&fcmax<t));++i)op=lo.data.instant.details,dt.ws_series.data.push([t,my.ntof2p(op.wind_speed)]),dt.wg_series.data.push([t,my.ntof2p(op.wind_speed_of_gust)]),dt.wd_series.data.push([t,my.ntof2p(op.wind_from_direction)]),dt.temp_series.data.push([t,my.ntof2p(op.air_temperature)]),dt.press_series.data.push([t,my.ntof2p(op.air_pressure_at_sea_level)]),dt.humid_series.data.push([t,my.ntof2p(op.relative_humidity)]),"graph"!==my.samplemode&&(op=lo.data.next_1_hours||lo.data.next_6_hours||lo.data.next_12_hours)&&(op=0<op.details.precipitation_amount_max?op.details.precipitation_amount_min+"-"+op.details.precipitation_amount_max:op.details.precipitation_amount,dt.rain_series.data.push([t,op]));dt.last=yr_get_time(data.properties.meta.updated_at).getTime()+0,last_time=dt.last},dometa:function(box,data){var cnt=$("#"+box+"meta"),cntn=null;cnt&&cnt.length?cnt.html(data):(cntn=1===(cnt=$(".meta")).length?$(cnt[0]):2===cnt.length?$(cnt[1]):null)&&cntn.append('<div class="'+box+'-focecast-meta-info">'+data+"</div>")},done:function(){var i1,i2,i3,dn,kn,self=my,i=ajax_done=0,j=0,hlinks=Object.keys(get.dataseries)[0],dt=(get.dataseries[my.fcsource||my.fcsources[0]]||get.dataseries[hlinks])[my.fcplace]||{},hlinks=my.fcplaces[my.fcplace],loc=hlinks.location,has={ws:dt.ws_series&&dt.ws_series.data.length,wg:dt.wg_series&&dt.wg_series.data.length,wd:dt.wd_series&&dt.wd_series.data.length,humid:dt.humid_series&&dt.humid_series.data.length,rain:dt.rain_series&&dt.rain_series.data.length,press:dt.press_series&&dt.press_series.data.length,temp:dt.temp_series&&dt.temp_series.data.length},dbase=has.ws?dt.ws_series.data:has.temp?dt.temp_series.data:has.wd?dt.wd_series.data:[],k=0,l=0;if("graph"===my.samplemode){$("#"+my.chartorder[0]+"2").css({height:""}),$("#"+my.chartorder[1]+"2").show(),$("#"+my.chartorder[2]+"2").show(),0<=my.chartorder.indexOf("wind_speed")&&(my.charts[3]=new Highcharts.Chart(wind_speed_options),i1=intPlotLine(my.charts[3],i1)),0<=my.chartorder.indexOf("wind_dir")&&(my.charts[4]=new Highcharts.Chart(wind_dir_options),i2=intPlotLine(my.charts[4],i2)),0<=my.chartorder.indexOf("temp")&&(my.charts[5]=new Highcharts.Chart(temp_options),i3=intPlotLine(my.charts[5],i3));for(var nightPlots=my.nightPlots(get.datalen,loc),i=3,j=6;i<j;++i)for(k=0,l=nightPlots.length;k<l;++k)my.charts[i]&&my.charts[i].xAxis[0].addPlotBand(nightPlots[k])}else{var o,str="",hlinks='<tr class="fcontainer"><th colspan="6"><span class="fc-source" name="em">Ilmateenistus</span>&nbsp;<span class="fc-source" name="wg">Windguru.cz</span>&nbsp;<span class="fc-source" name="yr">Yr.no</span><span class="right fchead">'+hlinks.name+"</span></th></tr>",keys=Object.keys(has),tnow=(new Date).getTime();for(i=0,j=dbase.length;i<j;++i)if(!((dn=dbase[i][0]||0)<tnow)){for(var sun=SunCalc.getPosition(new Date(dn),loc[0],loc[1]),opt={time:self.getTimeStr(dn),night:sun.altitude<0,dn:self.dirs(dt.wd_series.data[i][1]),wscolor:has.ws?self.colorasbf(dt.ws_series.data[i][1]).color:"",wgcolor:has.wg?self.colorasbf(dt.wg_series.data[i][1]).color:"",day:self.getDayLetter(dn),hide:!self.fcshownight},k=0,l=keys.length;k<l;++k)o=has[kn=keys[k]]?dt[kn+"_series"].data[i]:null,opt[kn]=o?o[1]:null;str+=_.template(self.fcRowTemplate)(opt)}var metadata=$("#"+my.chartorder[0]+"2");metadata&&(metadata.html(_.template(self.dataTableTemplate)({classes:"table",thead:_.template(self.fcHeadTemplate)({inforows:hlinks}),tbody:str})),metadata.css("height","100%")),$("#"+my.chartorder[1]+"2").hide(),$("#"+my.chartorder[2]+"2").hide(),metadata=$(".fc-source"),_.each(metadata,function(a){$(a).attr("name")===my.fcsource?$(a).css("font-weight","600"):$(a).css("font-weight","400")}),$(".fc-source").on("click",function(){w.ilm.setFcSource($(this).attr("name"))})}$("#fctitle").html("Prognoos <b>"+my.fcplaces[my.fcplace].name+"</b> "+my.getTimeStr(last_time)).show();metadata=_.map(my.fcplaces,function(a){if(!my.showgroup||my.fcplaces[a.id].group===my.showgroup)return'<li><a href="#" name="'+a.id+'" class="fcplace-select'+(a.id===my.fcplace?" active":"")+'">'+a.name+"</a></li>"}).join("");$("#fcmenu").html(metadata),$("#fcsel").show(),$(".fcplace-select").on("click",function(){w.ilm.fcsource=$(this).attr("name"),w.ilm.reloadest()}),$("#pagelogo").html(my.logo+' <span style="font-size:70%">'+my.getTimeStr(my.getTime())+"</span>");metadata=get.fclink("Meteo.pl");metadata&&get.dometa("meteo-pl",metadata)}};my.loadEst=function(place){if($("#"+my.chartorder[0]+"2").length){place=place||my.fcplace||"tabivere",ajax_done=0,wind_speed_options.series=null,wind_speed_options.series=[],wind_speed_options.chart.renderTo="wind_speed2",wind_dir_options.series=null,wind_dir_options.series=[],wind_dir_options.chart.renderTo="wind_dir2",temp_options.series=null,temp_options.series=[],temp_options.chart.renderTo="temp2";var cnt=$(".meta");1===cnt.length&&(cnt[0].innerHTML=""),2===cnt.length&&(cnt[1].innerHTML="");for(var a,i=my.fcsources.length-1;0<=i;i--)a=my.fcsources[i],get.do(place,a,get["do_"+a])}};var intval=0;my.loadEstInt=function(interval){interval&&1e4<interval?updateinterval=interval:interval=updateinterval,my.loadEst(),clearInterval(intval),intval=setInterval(my.loadEst,interval)},my.reloadest=function(){my.loadEstInt()}}(window.ilm||{}),function(my){"use strict";var w=window;w.$;w.openNew=w.openNew||function(url){return w.open(url,"_new"),!1},my.lingid=my.lingid||{JSON:{list:[{name:"Ilmalingid",list:[{name:"EMHI",url:"http://www.ilmateenistus.ee/",list:[{href:"ilm/ilmavaatlused/vaatlusandmed/?filter%5BmapLayer%5D=wind",title:"Ilmavaatlused - tuul",id:"emhi_kaart"},{href:"ilm/prognoosid/mudelprognoosid/eesti/#layers/tuul10ms,tuul10mb",title:"Prognoos - Suur Hirlam",id:"emhi_hirlam_suur"}]},{name:"WindGuru",url:"http://www.windguru.cz/",list:[{href:"365700",title:"Tartu",id:"windguru_tartu"},{href:"266923",title:"Saadj&auml;rv",id:"windguru_aksi"},{href:"204512",title:"V&otilde;rtsj&auml;rv Tamme",id:"windguru_tamme"},{href:"92781",title:"P&auml;rnu",id:"windguru_parnu"},{href:"152536",title:"H&auml;&auml;demeeste",id:"windguru_haademeeste"},{href:"125320",title:"Tallinn",id:"windguru_tallinn"},{href:"108163",title:"Saaremaa Sõrve",id:"windguru_sorve"},{href:"96592",title:"Hiiumaa Ristna",id:"windguru_ristna"},{href:"92777",title:"Hiiumaa Orjaku",id:"windguru_orjaku"},{href:"479054",title:"Pärnumaa Paatsalu",id:"windguru_paatsalu"},{href:"?set=143499",title:"Eesti Meri",id:"windguru_meri"},{href:"?set=143439",title:"Sisej&auml;rved",id:"windguru_jarved"}]},{name:"YR.no",url:"https://www.yr.no/en/details/table/",list:[{href:"2-588335",title:"Tartu",id:"yr_tartu"},{href:"2-592574",title:"Saadjärv",id:"yr_aksi"},{href:"2-588397",title:"Võrtsjärv Tamme",id:"yr_tamme"},{href:"2-591907",title:"Võrtsjärv Jõesuu",id:"yr_joesuu"},{href:"2-587468",title:"Peipsi Räpina",id:"yr_rapina"},{href:"2-589982",title:"Peipsi Nina",id:"yr_nina"},{href:"2-590067",title:"Peipsi Mustvee",id:"yr_mustvee"},{href:"2-589580",title:"Pärnu",id:"yr_parnu"},{href:"2-592232",title:"Häädemeeste",id:"yr_parnu"},{href:"2-10123592",title:"Tallinn Pirita",id:"yr_pirita"},{href:"2-588984",title:"Tallinn Rohuneeme",id:"yr_rohuneeme"},{href:"2-794645",title:"Saaremaa Sõrve",id:"yr_sorve"},{href:"2-589003",title:"Hiiumaa Ristna",id:"yr_ristna"},{href:"2-794840",title:"Hiiumaa Orjaku",id:"yr_orjaku"},{href:"2-796115",title:"Dirhami",id:"yr_dirhami"},{href:"2-589749",title:"Pärnumaa Paatsalu",id:"yr_paatsalu"},{href:"2-794885",title:"Topu",id:"yr_topu"},{href:"2-587445",title:"Võsu",id:"yr_vosu"}]},{name:"Meteo.pl",url:"http://new.meteo.pl/um/php/meteorogram_map_um.php?lang=en&ntype=0u",list:[{href:"&row=227&col=325",title:"Saadj&auml;rv",id:"meteopl_saadjarv_aksi"},{href:"&row=234&col=318",title:"Võrtsj&auml;rv Tamme",id:"meteopl_vortsjarv_tamme"},{href:"&row=227&col=318",title:"Võrtsj&auml;rv Jõesuu",id:"meteopl_vortsjarv_joesuu"},{href:"&row=234&col=339",title:"Peipsi Räpina",id:"meteopl_peipsi_rapina"},{href:"&row=234&col=339",title:"Peipsi Nina",id:"meteopl_peipsi_nina"},{href:"&row=234&col=339",title:"Peipsi Mustvee",id:"meteopl_peipsi_mustvee"},{href:"&row=234&col=297",title:"Pärnu",id:"meteopl_parnu"},{href:"&row=241&col=297",title:"Häädemeeste",id:"meteopl_haademeeste"},{href:"&row=199&col=297",title:"Tallinn",id:"meteopl_pirita"},{href:"&row=248&col=262",title:"Saaremaa Sõrve",id:"meteopl_sorve"},{href:"&row=220&col=262",title:"Hiiumaa Ristna",id:"meteopl_ristna"},{href:"&row=220&col=269",title:"Hiiumaa Orjaku",id:"meteopl_orjaku"},{href:"&row=213&col=283",title:"Dirhami",id:"meteopl_dirhami"},{href:"&row=227&col=283",title:"Virtsu",id:"meteopl_paatsalu"},{href:"&row=220&col=276",title:"Topu",id:"meteopl_topu"},{href:"&row=199&col=304",title:"Loksa",id:"meteopl_loksa"}]},{name:"WeatherOnline",url:"http://www.weatheronline.co.uk/",list:[{href:"marine/weather?LEVEL=3&LANG=en&MENU=0&TIME=18&MN=gfs&WIND=g005",title:"Soome Laht",id:"weatheronline_sl"}]},{name:"Windfinder.com",url:"http://www.windfinder.com/forecast/",list:[{href:"aeksi_saadjaerv",title:"Saadj&auml;rv",id:"windfinder_saadjarv"},{href:"tartu_airport",title:"Tartu",id:"windfinder_tartu"},{href:"mustvee_peipus&wf_cmp=2",title:"Mustvee Peipsi",id:"windfinder_mustvee"}]},{name:"GisMeteo.ru",url:"http://www.gismeteo.ru/towns/",list:[{href:"26242.htm",title:"Tartu",id:"gismeteo_tartu"},{href:"26231.htm",title:"P&auml;rnu",id:"gismeteo_parnu"},{href:"26038.htm",title:"Tallinn",id:"gismeteo_tallinn"}]},{name:"Muud",url:"http://",list:[{href:"www.meteo.lt/en/weather-forecast#windDirectionDesc",title:"Meteo.LT",id:"meteolt"},{href:"maps.meteo.pl",title:"Meteo.PL Maps",id:"meteoplmaps"},{href:"on-line.msi.ttu.ee/meretase/",title:"MSI Meretase",id:"msi-ttu"},{href:"d.naerata.eu/",title:"Naerata.eu",id:"naerata"},{href:"teeinfo.evenet.ee/?mapdatatype=9",title:"Teeinfo",id:"teeinfo"},{href:"surf.paper.ee/",title:"Surf.Paper.EE",id:"paper"},{href:"palts.com/a/et_EE/ilmajaam/",title:"Palts.COM",id:"palts"},{href:"ilm.zoig.ee/",title:"Zoig.EE",id:"zoig",app:"?k=516"},{href:"www.kalastusinfo.ee/sisu/ilm/ilm-peipsi-jarvel.php",title:"Peipsi Ilmajaamad",id:"kalastusinfo"},{href:"www.wunderground.com/global/stations/26242.html",title:"WUnderground Tartu",id:"wground"},{href:"www.timeanddate.com/worldclock/astronomy.html?n=242",title:"Päikesetõus/loojang",id:"sunclock"}]}]},{name:"Surfilingid",list:[{name:"Eesti",url:"http://",list:[{href:"www.surf.ee/chat/",title:"Surf.ee chat",id:"surfichat"},{href:"http://www.lesurf.ee/index.php?ID=33",title:"Surfiturg",id:"surfiturg"},{href:"www.lesurf.ee/",title:"L&otilde;una surfarid",id:"lesurf"},{href:"www.purjelaualiit.ee/",title:"Eesti Purjelaualiit",id:"purjelaualiit"},{href:"www.gps-speedsurfing.com/",title:"GPS Speedsurfing",id:"gps-speedsurfing"}]}]}]},process:function(f,u){var s="",i=0,patt=new RegExp("^http");if(u=void 0===u?"":u,null!==f.href&&f.href)s+="<li>",s+='<a href="'+(!1===patt.test(f.href)?u:"")+f.href+(f.title?'" title="'+f.title:"")+(f.id?'" id="'+f.id:"")+'" onclick="var a=\''+(f.app||"")+"';return openNew(this.href+a);\">",s+=(f.name||f.title)+"</a></li>";else if(f.list){for(i in f.name&&(s+='<div class="lingid">',f.list[0].href||(s+='<div class="ok">'),s+=f.name,f.list[0].href||(s+="</div>")),f.url&&(s+="<ul>"),f.list)s+=this.process(f.list[i],f.url);f.url&&(s+="</ul>"),f.name&&(s+="</div>")}return s}}}(ilm||{}),function(w){"use strict";var $=w.$,d=document,e=d.documentElement,g=d.getElementsByTagName("body")[0],my=w.ilm;w.ilm.popup="",w.ilm.Options=function(state){var f=$("#lingid");return $("#sl").html("Seaded (klikk varjamiseks)"),my.settingTemplate(f),!1};function toggleOffClickActive(b){b.toggleClass("menu-is-open")}function addOffClick(e,cb,target){function offClick(evt){!evt||target&&$(evt.target).closest(target).length||e===evt||e&&e.originalEvent===evt||(cb&&cb(),document.removeEventListener("click",offClick))}document.addEventListener("click",offClick)}w.ilm.Lingid=function(state){var f=$("#lingid");return $("#sl").html("Lingid (klikk varjamiseks)"),f.html(w.ilm.lingid.process(w.ilm.lingid.JSON)),!1},w.ilm.Popup={popupEvent:null,isOpen:!1,render:function(name,cb,swp){swp&&(w.ilm.Popup.popupEvent=swp);var ev=w.ilm.Popup.popupEvent,v=$("#popup");if(!v)return!1;var b=$("#bghide"),hh=$(".navbar").height(),y=w.innerHeight||e.clientHeight||g.clientHeight,act=v.attr("name"),swp=0;act&&$("#ilm-"+act).parent().removeClass("active");var t=ev?$(ev.target):null;return t&&!t.hasClass("menu-is-open")&&(toggleOffClickActive(t),addOffClick(ev,function(){w.ilm.Popup.render(name),toggleOffClickActive(t)},"#popup")),!name||act&&act===name?v.is(":visible")&&(v.hide(),b.hide(),v.attr("name","")):(b.css({height:$(d).height(),position:"absolute",left:0,top:0}).show(),v.attr("name",name),$("#ilm-"+name).parent().addClass("active"),cb&&cb.call(this,name),swp=y/2-v.height()/2+$(w).scrollTop(),v.css({top:0<swp?swp:hh}).show()),!1}};$(d).ready(function(){$("#pagelogo").html(w.ilm.logo),$("#ilm-viited").click(function(a){var b=$(a.target);a.preventDefault(),w.ilm.linksasmenu?(b.attr({"data-toggle":"dropdown"}),b.addClass("dropdown-toggle"),(a=$(".ilm-viited-dropdown")).html(w.ilm.lingid.process(w.ilm.lingid.JSON)),a.height(w.innerHeight-w.innerHeight/3)):(b.removeClass("dropdown-toggle"),b.attr({"data-toggele":"modal","data-target":".ilm-modal"}),$("#ilm-modal .popup-sisu").html(w.ilm.lingid.process(w.ilm.lingid.JSON)),$("#ilm-modal").modal())}),$("#ilm-seaded").click(function(e){my.settingTemplate("#ilm-seaded-dropdown")}),$("#fctitle").on("click",function(){return w.ilm.setEstPlace(w.ilm.nextPlace()),!1});var dtpckr=$("#datepicker");dtpckr.length&&(dtpckr.datepicker({dateFormat:"yy-mm-dd",timezone:"+0"+(2+(my.addDst?1:0))+"00",onSelect:function(dateText,inst){w.ilm.setDate(dateText)}}),$("#curtime").on("click",function(){dtpckr.datepicker("show")})),$("#curplace").on("click",function(){return w.ilm.setCurPlace(w.ilm.nextCurPlace()),!1}),w.ilm.loadGrid(),w.ilm.loadBase(),w.ilm.loadInt(6e4),w.ilm.loadEstInt(6e5),$("#backgr").css({display:"block"}),$(w).on("keydown",function(e){$("#popup")&&(27===e.keyCode||e.keyCode)}),$(w).on("hashchange",function(){console.log("hash changed "+w.location.hash),w.ilm.hash_data()})})}(window);